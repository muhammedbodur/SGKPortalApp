

?? ZKTeco API Client yapılandırıldı: http://localhost:8091
?? ZKTeco Realtime Service yapılandırıldı: http://localhost:8091/signalr
?? ZKTeco Business Services yapılandırıldı
??  Development ortamı - Migration'lar manuel uygulanmalı (Add-Migration, Update-Database)

╔════════════════════════════════════════════════════════╗
║         SGK PORTAL API BAŞLATILIYOR...                 ║
╚════════════════════════════════════════════════════════╝
?? Ortam: Development
?? HTTPS URL: https://localhost:9080
?? HTTP URL: http://localhost:9081
?? Swagger: https://localhost:9080
??  Health: https://localhost:9080/health
??  Health Ready: https://localhost:9080/health/ready
??  Health Live: https://localhost:9080/health/live
╚════════════════════════════════════════════════════════╝

info: SGKPortalApp.ApiLayer.Services.BackgroundServices.ZKTecoRealtimeListenerService[0]
      ZKTeco Realtime - SaveToDatabase: False
info: SGKPortalApp.DataAccessLayer.Services.Audit.AuditMaintenanceService[0]
      Audit maintenance service started
info: SGKPortalApp.DataAccessLayer.Services.Audit.AuditMaintenanceService[0]
      Next maintenance run scheduled at 01/27/2026 02:00:00
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? MySqlSyncService başlatıldı. Sync aralığı: 5 dakika
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Sync başlıyor...
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Departmanlar sync ediliyor...
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Session.SessionCleanupService[0]
      ?? SessionCleanupService başlatıldı - Temizlik aralığı: 00:10:00
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Session.IdleSessionCleanupService[0]
      ?? IdleSessionCleanupService başlatıldı - Interval: 5 dakika, Timeout: 30 dakika
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.ZKTeco.AttendanceSyncService[0]
      ?? AttendanceSyncService started
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.ZKTeco.AttendanceSyncService[0]
      ?? Scheduled sync times: 00:00, 12:00
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.ZKTeco.AttendanceSyncService[0]
      ?? Device sync interval: 5 minutes
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.ZKTeco.AttendanceSyncService[0]
      ? Next check at: 15:00 (in 43 minutes)
info: SGKPortalApp.ApiLayer.Services.BackgroundServices.ZKTecoRealtimeListenerService[0]
      ?? ZKTecoRealtimeService starting...
info: SGKPortalApp.BusinessLogicLayer.Services.PdksIslemleri.ZKTecoRealtimeService[0]
      Starting SignalR connection to: http://localhost:8091/signalr
info: SGKPortalApp.BusinessLogicLayer.Services.PdksIslemleri.ZKTecoRealtimeService[0]
      SignalR connection started successfully. State: Connected
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:9080
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:9081
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: D:\AspNetExamples\SGKPortalApp\SGKPortalApp.ApiLayer
info: SGKPortalApp.ApiLayer.Services.Hubs.SiramatikHub[0]
      ?? [SiramatikHub] Yeni bağlantı: B3v8qxJagwuuSXW-v-9C-g - Kullanıcı: TV Kullanıcısı (TC: 12345678901)
info: SGKPortalApp.ApiLayer.Services.Hubs.SiramatikHub[0]
      ?? Page Lifecycle: isRefresh=True, isNewTab=False, isTvDisplay=False, tabSessionId=70976b3b-e2c9-41ec-ba3d-813322991cbc
warn: Microsoft.EntityFrameworkCore.Model.Validation[10622]
      Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'LoginLogoutLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[10622]
      Entity 'HizmetBinasi' has a global query filter defined and is the required end of a relationship with the entity 'Device'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'LogStorageType' property 'StorageType' on entity type 'DatabaseLog' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value '0', since this is the CLR default for the 'LogStorageType' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Duyuru' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'GununMenusu' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'OnemliLink' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'SikKullanilanProgram' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'UserType' property 'UserType' on entity type 'User' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value '0', since this is the CLR default for the 'UserType' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Departman' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Servis' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Unvan' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Banko' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Kiosk' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'KioskMenu' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[20601]
      The 'Aktiflik' property 'Aktiflik' on entity type 'Tv' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pasif', since this is the CLR default for the 'Aktiflik' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
info: SGKPortalApp.ApiLayer.Services.BackgroundServices.ZKTecoRealtimeListenerService[0]
      Found 0 active ZKTeco devices
info: SGKPortalApp.ApiLayer.Services.BackgroundServices.ZKTecoRealtimeListenerService[0]
      ? ZKTecoRealtimeService started successfully
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ? Departmanlar: 33 eklendi, 0 güncellendi
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Servisler sync ediliyor...
info: SGKPortalApp.BusinessLogicLayer.Services.SignalR.HubConnectionBusinessService[0]
      ? Başlangıç temizliği: 1 connection offline yapıldı
info: SGKPortalApp.ApiLayer.Controllers.SignalR.HubConnectionController[0]
      Cleanup startup: 1 connection temizlendi
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ? Servisler: 104 eklendi, 0 güncellendi
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Ünvanlar sync ediliyor...
info: SGKPortalApp.ApiLayer.Services.Hubs.SiramatikHub[0]
      ? Yeni bağlantı oluşturuldu: B3v8qxJagwuuSXW-v-9C-g | TC: 12345678901 | Type: MainLayout | IP: ::1
info: SGKPortalApp.ApiLayer.Services.Hubs.SiramatikHub[0]
      ?? Banko modu kontrolü: isBankoMode=False
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ? Ünvanlar: 88 eklendi, 0 güncellendi
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Hizmet Binaları sync ediliyor...
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ? Hizmet Binaları: 43 eklendi, 0 güncellendi, 0 atlandı
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Departman-Bina İlişkileri sync ediliyor...
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ?? 72 adet benzersiz departman-bina eşleşmesi bulundu
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
        ? Departman-Bina İlişkileri: 70 eklendi, 2 atlandı
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ?? Personeller sync ediliyor...
fail: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ? SyncPersonellerAsync hatası
      System.InvalidOperationException: The instance of entity type 'DepartmanHizmetBinasi' cannot be tracked because another instance with the same key value for {'DepartmanHizmetBinasiId'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(InternalEntityEntry entry)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddAsync(TEntity entity, CancellationToken cancellationToken)
         at SGKPortalApp.DataAccessLayer.Repositories.Generic.GenericRepository`1.AddAsync(T entity) in D:\AspNetExamples\SGKPortalApp\SGKPortalApp.DataAccessLayer\Repositories\Generic\GenericRepository.cs:line 75
         at SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService.SyncPersonellerAsync(ILegacyKullaniciRepository legacyRepo, IUnitOfWork unitOfWork, CancellationToken ct) in D:\AspNetExamples\SGKPortalApp\SGKPortalApp.BusinessLogicLayer\Services\BackgroundServices\Sync\MySqlSyncService.cs:line 511
         at SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService.SyncAllAsync(CancellationToken cancellationToken) in D:\AspNetExamples\SGKPortalApp\SGKPortalApp.BusinessLogicLayer\Services\BackgroundServices\Sync\MySqlSyncService.cs:line 119
info: SGKPortalApp.BusinessLogicLayer.Services.BackgroundServices.Sync.MySqlSyncService[0]
      ? Sync tamamlandı
