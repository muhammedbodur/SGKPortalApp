@page "/personel/create"
@page "/personel/manage/{tcKimlikNo}"
@inherits SGKPortalApp.PresentationLayer.Components.Base.FieldPermissionPageBase
@using SGKPortalApp.BusinessObjectLayer.Enums.PersonelIslemleri
@using SGKPortalApp.BusinessObjectLayer.Enums.Common
@using SGKPortalApp.Common.Helpers

<PageTitle>@(IsEditMode ? "Personel DÃ¼zenle" : "Yeni Personel") - SGK Portal</PageTitle>
@if (!CanViewPage)
{
    <div class="alert alert-danger" role="alert">
        <i class="bx bx-lock-alt me-2"></i>
        Bu sayfayÄ± gÃ¶rÃ¼ntÃ¼leme yetkiniz bulunmuyor.
    </div>
}
else
{
    <FieldPermissionScope PageKey="@ResolvedPermissionKey" IsEditMode="true">
        <div class="container-xxl flex-grow-1 container-p-y">
            <h4 class="py-3 mb-4">
                <span class="text-muted fw-light">Personel /</span> @(IsEditMode ? "DÃ¼zenle" : "Yeni Ekle")
            </h4>

            @if (IsLoading)
            {
                <div class="card">
                    <div class="card-body text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">YÃ¼kleniyor...</span>
                        </div>
                        <p class="text-muted">@(IsEditMode ? "Personel bilgileri yÃ¼kleniyor..." : "HazÄ±rlanÄ±yor...")</p>
                    </div>
                </div>
            }
            else if (!IsEditMode && CurrentStep == 1)
            {
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- ADIM 1: TC + AD SOYAD (Sadece Yeni Ekleme Ä°Ã§in) -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div class="row">
                    <div class="col-lg-6 col-xl-5 mx-auto">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bx bx-user-plus me-2"></i>Yeni Personel Ekle - AdÄ±m 1/2
                                </h5>
                            </div>
                            <div class="card-body">
                                <EditForm Model="@Step1Model" OnValidSubmit="HandleStep1Submit">
                                    <DataAnnotationsValidator />

                                    <div class="mb-3">
                                        <label class="form-label required">TC Kimlik No</label>
                                        <InputText @bind-Value="Step1Model.TcKimlikNo"
                                                   class="form-control form-control-lg"
                                                   placeholder="11 haneli TC Kimlik No"
                                                   maxlength="11"
                                                   disabled="@IsSaving" />
                                        <ValidationMessage For="@(() => Step1Model.TcKimlikNo)" class="text-danger small mt-1" />
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label required">Ad Soyad</label>
                                        <InputText @bind-Value="Step1Model.AdSoyad"
                                                   class="form-control form-control-lg"
                                                   placeholder="Ad Soyad"
                                                   maxlength="200"
                                                   disabled="@IsSaving" />
                                        <ValidationMessage For="@(() => Step1Model.AdSoyad)" class="text-danger small mt-1" />
                                    </div>

                                    <div class="alert alert-info">
                                        <i class="bx bx-info-circle me-2"></i>
                                        Personel oluÅŸturulduktan sonra diÄŸer bilgileri girebilirsiniz.
                                    </div>

                                    <div class="d-flex gap-2 justify-content-end">
                                        <button type="button" class="btn btn-outline-secondary" @onclick="NavigateToPersonelList" disabled="@IsSaving">
                                            Ä°ptal
                                        </button>
                                        <button type="submit" class="btn btn-primary" disabled="@(IsSaving || !CanEditPage)">
                                            @if (IsSaving)
                                            {
                                                <span class="spinner-border spinner-border-sm me-1"></span>
                                            }
                                            Devam Et
                                            <i class="bx bx-chevron-right ms-1"></i>
                                        </button>
                                    </div>
                                </EditForm>
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- ADIM 2: TÃœM BÄ°LGÄ°LER (Sol Kart + SaÄŸ Tabs) -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                @if (!CanViewPage)
                {
                    <div class="alert alert-danger" role="alert">
                        Bu sayfayÄ± gÃ¶rÃ¼ntÃ¼leme yetkiniz bulunmuyor.
                    </div>
                }
                else
                {
                        <CascadingValue Name="FieldPermissionIsEditMode" Value="@IsEditMode">
                            <EditForm Model="@FormModel" OnValidSubmit="HandleFinalSubmit">
                                <DataAnnotationsValidator />

                                <div class="row">
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <!-- SOL TARAF: PERSONEL KARTI -->
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <div class="col-xl-4 col-lg-5 col-md-5 order-1 order-md-0">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="user-avatar-section">
                                        <div class="d-flex align-items-center flex-column">
                                            @if (!string.IsNullOrEmpty(FormModel.Resim))
                                            {
                                                <CachedImage @key="@FormModel.Resim" Src="@FormModel.Resim" Class="img-fluid rounded my-4" Height="110" Width="110" Alt="Personel fotoÄŸrafÄ±" />
                                            }
                                            else
                                            {
                                                <div class="avatar avatar-xl my-4">
                                                    <span class="avatar-initial rounded bg-label-primary" style="font-size: 3rem;">
                                                        @(string.IsNullOrEmpty(FormModel.AdSoyad) ? "?" : FormModel.AdSoyad.Substring(0, 1).ToUpper())
                                                    </span>
                                                </div>
                                            }
                                            <div class="user-info text-center">
                                                <h4 class="mb-2">@(string.IsNullOrEmpty(FormModel.AdSoyad) ? "Yeni Personel" : FormModel.AdSoyad)</h4>
                                                <span class="badge bg-label-primary">@(IsEditMode ? "DÃ¼zenleniyor" : "Yeni")</span>
                                            </div>
                                        </div>
                                    </div>

                                    <h5 class="pb-2 border-bottom mb-4 mt-4">Temel Bilgiler</h5>
                                    <div class="info-container">
                                        <ul class="list-unstyled">
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">TC Kimlik No:</span>
                                                <span>@FormModel.TcKimlikNo</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Sicil No:</span>
                                                <span>@FormModel.SicilNo</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Email:</span>
                                                <span>@FormModel.Email</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Departman:</span>
                                                <span>@GetDepartmanAdi(FormModel.DepartmanId)</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Servis:</span>
                                                <span>@GetServisAdi(FormModel.ServisId)</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Ãœnvan:</span>
                                                <span>@GetUnvanAdi(FormModel.UnvanId)</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Dahili:</span>
                                                <span>@FormModel.Dahili</span>
                                            </li>
                                            <li class="mb-3">
                                                <span class="fw-medium me-2">Cep Telefonu:</span>
                                                <span>@FormModel.CepTelefonu</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <!-- SAÄž TARAF: TABS + FORM Ä°Ã‡ERÄ°KLERÄ° -->
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <div class="col-xl-8 col-lg-7 col-md-7 order-0 order-md-1">
                            <!-- Tabs -->
                            <ul class="nav nav-tabs flex-column flex-md-row mb-3" role="tablist">
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "personel" ? "active" : "")" 
                                            @onclick="SetPersonelTab" type="button">
                                        <i class="bx bx-user me-1"></i>Personel
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "iletisim" ? "active" : "")" 
                                            @onclick="SetIletisimTab" type="button">
                                        <i class="bx bx-phone me-1"></i>Ä°letiÅŸim
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "kisisel" ? "active" : "")" 
                                            @onclick="SetKisiselTab" type="button">
                                        <i class="bx bx-id-card me-1"></i>KiÅŸisel
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "ozluk" ? "active" : "")" 
                                            @onclick="SetOzlukTab" type="button">
                                        <i class="bx bx-file me-1"></i>Ã–zlÃ¼k
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "es-cocuk" ? "active" : "")" 
                                            @onclick="SetEsCocukTab" type="button">
                                        <i class="bx bx-group me-1"></i>EÅŸ/Ã‡ocuk
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "hizmet" ? "active" : "")" 
                                            @onclick="SetHizmetTab" type="button">
                                        <i class="bx bx-briefcase me-1"></i>Hizmet
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "egitim" ? "active" : "")" 
                                            @onclick="SetEgitimTab" type="button">
                                        <i class="bx bx-book me-1"></i>EÄŸitim
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "yetki" ? "active" : "")" 
                                            @onclick="SetYetkiTab" type="button">
                                        <i class="bx bx-key me-1"></i>Yetki
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "ceza" ? "active" : "")" 
                                            @onclick="SetCezaTab" type="button">
                                        <i class="bx bx-error me-1"></i>Ceza
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "engel" ? "active" : "")" 
                                            @onclick="SetEngelTab" type="button">
                                        <i class="bx bx-accessibility me-1"></i>Engel
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link @(ActiveTab == "fotograf" ? "active" : "")" 
                                            @onclick="SetFotografTab" type="button">
                                        <i class="bx bx-image me-1"></i>FotoÄŸraf
                                    </button>
                                </li>
                            </ul>

                            <!-- PERSONEL TAB -->
                            @if (ActiveTab == "personel")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">Personel Bilgileri</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- TC Kimlik No -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label required">TC Kimlik No</label>
                                                <InputText @bind-Value="FormModel.TcKimlikNo"
                                                           class="form-control"
                                                           disabled="@IsEditMode"
                                                           maxlength="11" />
                                                <ValidationMessage For="@(() => FormModel.TcKimlikNo)" class="text-danger small" />
                                            </div>

                                            <!-- Sicil No (PermissionField component ile) -->
                                            <PermissionField FieldName="@nameof(FormModel.SicilNo)" Context="perm">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Sicil No</label>
                                                    <InputNumber @bind-Value="FormModel.SicilNo"
                                                                 class="form-control"
                                                                 disabled="@(perm.IsDisabled || IsSaving)" />
                                                </div>
                                            </PermissionField>

                                            <!-- Ad Soyad -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label required">Ad Soyad</label>
                                                <InputText @bind-Value="FormModel.AdSoyad"
                                                           @bind-Value:after="() => FormModel.NickName = StringHelper.GenerateNickName(FormModel.AdSoyad, 12)"
                                                           class="form-control"
                                                           maxlength="200" />
                                                <ValidationMessage For="@(() => FormModel.AdSoyad)" class="text-danger small" />
                                            </div>

                                            <!-- Nick Name -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Nick Name</label>
                                                <InputText @bind-Value="FormModel.NickName"
                                                           class="form-control"
                                                           maxlength="50"
                                                           disabled />
                                                <small class="form-text text-muted">Otomatik oluÅŸturulur</small>
                                            </div>

                                            <!-- Departman -->
                                            <PermissionField FieldName="@nameof(FormModel.DepartmanId)" Context="perm">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Departman</label>
                                                    <select id="departmanSelect"
                                                            value="@FormModel.DepartmanId"
                                                            @onchange="async (e) => await OnDepartmanChangedAsync(e)"
                                                            class="form-select @(FormModel.DepartmanId == 0 ? "border-warning" : "")"
                                                            data-placeholder="Departman seÃ§iniz"
                                                            disabled="@(perm.IsDisabled || IsSaving)">
                                                        <option value="0">SeÃ§iniz</option>
                                                        @foreach (var departman in Departmanlar)
                                                        {
                                                            <option value="@departman.DepartmanId">@departman.DepartmanAdi</option>
                                                        }
                                                    </select>
                                                    @if (FormModel.DepartmanId == 0)
                                                    {
                                                        <small class="text-muted">ðŸ“¦ @Departmanlar.Count departman yÃ¼klendi</small>
                                                    }
                                                </div>
                                            </PermissionField>

                                            <!-- Servis -->
                                            <PermissionField FieldName="@nameof(FormModel.ServisId)" Context="perm">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Servis</label>
                                                    <select id="servisSelect"
                                                            value="@FormModel.ServisId"
                                                            @onchange="OnServisChanged"
                                                            class="form-select @(FormModel.ServisId == 0 ? "border-warning" : "")"
                                                            data-placeholder="Servis seÃ§iniz"
                                                            disabled="@(perm.IsDisabled || IsSaving)">
                                                        <option value="0">SeÃ§iniz</option>
                                                        @foreach (var servis in Servisler)
                                                        {
                                                            <option value="@servis.ServisId">@servis.ServisAdi</option>
                                                        }
                                                    </select>
                                                    @if (FormModel.ServisId == 0)
                                                    {
                                                        <small class="text-muted">ðŸ“¦ @Servisler.Count servis yÃ¼klendi</small>
                                                    }
                                                </div>
                                            </PermissionField>

                                            <!-- Unvan -->
                                            <PermissionField FieldName="@nameof(FormModel.UnvanId)" Context="perm">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Unvan</label>
                                                    <select id="unvanSelect"
                                                            value="@FormModel.UnvanId"
                                                            @onchange="OnUnvanChanged"
                                                            class="form-select @(FormModel.UnvanId == 0 ? "border-warning" : "")"
                                                            data-placeholder="Ãœnvan seÃ§iniz"
                                                            disabled="@(perm.IsDisabled || IsSaving)">
                                                        <option value="0">SeÃ§iniz</option>
                                                        @foreach (var unvan in Unvanlar)
                                                        {
                                                            <option value="@unvan.UnvanId">@unvan.UnvanAdi</option>
                                                        }
                                                    </select>
                                                    @if (FormModel.UnvanId == 0)
                                                    {
                                                        <small class="text-muted">ðŸ“¦ @Unvanlar.Count Ã¼nvan yÃ¼klendi</small>
                                                    }
                                                </div>
                                            </PermissionField>

                                            <!-- Hizmet BinasÄ± (Departmana baÄŸlÄ±) -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">
                                                    Hizmet BinasÄ±
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <select id="hizmetBinasiSelect"
                                                        value="@FormModel.DepartmanHizmetBinasiId"
                                                        @onchange="OnDepartmanHizmetBinasiChanged"
                                                        class="form-select @(FormModel.DepartmanHizmetBinasiId == 0 ? "border-danger" : "")"
                                                        data-placeholder="Hizmet BinasÄ± seÃ§iniz"
                                                        disabled="@(IsSaving || FormModel.DepartmanId == 0)">
                                                    <option value="0">SeÃ§iniz</option>
                                                    @foreach (var dhb in DepartmanHizmetBinalari)
                                                    {
                                                        <option value="@dhb.DepartmanHizmetBinasiId">@dhb.HizmetBinasiAdi @(dhb.AnaBina ? "(Ana Bina)" : "")</option>
                                                    }
                                                </select>
                                                @if (FormModel.DepartmanId == 0)
                                                {
                                                    <small class="text-info">
                                                        <i class="bx bx-info-circle me-1"></i>
                                                        Ã–nce departman seÃ§iniz
                                                    </small>
                                                }
                                                else if (FormModel.DepartmanHizmetBinasiId == 0 && DepartmanHizmetBinalari.Any())
                                                {
                                                    <small class="text-danger">
                                                        <i class="bx bx-error-circle me-1"></i>
                                                        LÃ¼tfen hizmet binasÄ± seÃ§iniz (Toplam: @DepartmanHizmetBinalari.Count)
                                                    </small>
                                                }
                                                else if (FormModel.DepartmanId > 0 && !DepartmanHizmetBinalari.Any())
                                                {
                                                    <small class="text-warning">
                                                        <i class="bx bx-info-circle me-1"></i>
                                                        Bu departmana tanÄ±mlÄ± hizmet binasÄ± yok!
                                                    </small>
                                                }
                                            </div>

                                            <!-- Personel Tipi -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Personel Tipi</label>
                                                <select id="personelTipiSelect"
                                                        @bind="FormModel.PersonelTipi"
                                                        class="form-select"
                                                        data-no-select2="true"
                                                        disabled="@IsSaving">
                                                    @foreach (var tip in Enum.GetValues<PersonelTipi>())
                                                    {
                                                        <option value="@tip">@GetEnumDisplayName(tip)</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Atanma Nedeni -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Atanma Nedeni <span class="text-danger">*</span></label>
                                                <select @bind="FormModel.AtanmaNedeniId"
                                                        class="form-select"
                                                        id="atanmaNedeniSelect"
                                                        disabled="@IsSaving">
                                                    <option value="0">SeÃ§iniz...</option>
                                                    @foreach (var atanmaNedeni in AtanmaNedenleri)
                                                    {
                                                        <option value="@atanmaNedeni.AtanmaNedeniId">@atanmaNedeni.AtanmaNedeni</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Sendika -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Sendika</label>
                                                <select id="sendikaSelect"
                                                        @bind="FormModel.SendikaId"
                                                        class="form-select"
                                                        data-placeholder="Sendika seÃ§iniz"
                                                        disabled="@IsSaving">
                                                    <option value="0">SeÃ§iniz (Opsiyonel)</option>
                                                    @foreach (var sendika in Sendikalar)
                                                    {
                                                        <option value="@sendika.SendikaId">@sendika.SendikaAdi</option>
                                                    }
                                                </select>
                                                @if (FormModel.SendikaId == 0)
                                                {
                                                    <small class="text-muted">ðŸ“¦ @Sendikalar.Count sendika yÃ¼klendi</small>
                                                }
                                            </div>
                                        </div>

                                        <!-- Aktiflik Durumu -->
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Aktiflik Durumu <span class="text-danger">*</span></label>
                                                @if (IsEditMode)
                                                {
                                                    <div class="row">
                                                        <!-- Kurum Personeli -->
                                                        <div class="col-md-6">
                                                            <div class="card border-success mb-2">
                                                                <div class="card-header bg-success bg-opacity-10 py-2">
                                                                    <small class="fw-semibold text-success"><i class="bx bx-user-check me-1"></i>Kurum Personeli</small>
                                                                </div>
                                                                <div class="card-body py-2">
                                                                    @foreach (var durum in new[] { PersonelAktiflikDurum.Aktif, PersonelAktiflikDurum.AyliksizIzin, PersonelAktiflikDurum.GeciciGorevlendirme, PersonelAktiflikDurum.Askerlik, PersonelAktiflikDurum.UcretsizIzin })
                                                                    {
                                                                        <div class="form-check">
                                                                            <input class="form-check-input"
                                                                                   type="radio"
                                                                                   name="aktiflikDurumu"
                                                                                   id="aktiflik_@durum"
                                                                                   value="@durum"
                                                                                   checked="@(FormModel.PersonelAktiflikDurum == durum)"
                                                                                   @onchange="@(() => FormModel.PersonelAktiflikDurum = durum)" />
                                                                            <label class="form-check-label" for="aktiflik_@durum">
                                                                                @GetEnumDisplayName(durum)
                                                                            </label>
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- AyrÄ±lan Personel -->
                                                        <div class="col-md-6">
                                                            <div class="card border-danger mb-2">
                                                                <div class="card-header bg-danger bg-opacity-10 py-2">
                                                                    <small class="fw-semibold text-danger"><i class="bx bx-user-x me-1"></i>AyrÄ±lan Personel</small>
                                                                </div>
                                                                <div class="card-body py-2">
                                                                    @foreach (var durum in new[] { PersonelAktiflikDurum.Pasif, PersonelAktiflikDurum.Emekli, PersonelAktiflikDurum.Istifa, PersonelAktiflikDurum.KurumlararasiNakil, PersonelAktiflikDurum.Mustagfi, PersonelAktiflikDurum.Vefat })
                                                                    {
                                                                        <div class="form-check">
                                                                            <input class="form-check-input"
                                                                                   type="radio"
                                                                                   name="aktiflikDurumu"
                                                                                   id="aktiflik_@durum"
                                                                                   value="@durum"
                                                                                   checked="@(FormModel.PersonelAktiflikDurum == durum)"
                                                                                   @onchange="@(() => FormModel.PersonelAktiflikDurum = durum)" />
                                                                            <label class="form-check-label" for="aktiflik_@durum">
                                                                                @GetEnumDisplayName(durum)
                                                                            </label>
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="d-flex gap-4 flex-wrap">
                                                        <div class="form-check">
                                                            <input class="form-check-input"
                                                                   type="radio"
                                                                   name="aktiflikDurumu"
                                                                   id="aktiflik_aktif"
                                                                   value="@PersonelAktiflikDurum.Aktif"
                                                                   checked="true"
                                                                   disabled />
                                                            <label class="form-check-label" for="aktiflik_aktif">
                                                                @GetEnumDisplayName(PersonelAktiflikDurum.Aktif)
                                                            </label>
                                                        </div>
                                                        <small class="form-text text-muted">Yeni personel kaydÄ± aktif olarak oluÅŸturulur</small>
                                                    </div>
                                                }
                                            </div>

                                            @if (FormModel.PersonelAktiflikDurum != PersonelAktiflikDurum.Aktif)
                                            {
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Pasif/AyrÄ±lÄ±ÅŸ Nedeni</label>
                                                    <InputText @bind-Value="FormModel.PasifNedeni"
                                                               class="form-control"
                                                               placeholder="Ã–rn: Ä°stifa, Nakil, Emeklilik"
                                                               maxlength="200" />
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Durum DeÄŸiÅŸiklik Tarihi</label>
                                                    <input type="text"
                                                           @bind="FormModel.DurumDegisiklikTarihi"
                                                           @bind:format="yyyy-MM-dd"
                                                           class="form-control flatpickr-date"
                                                           placeholder="YYYY-MM-DD" />
                                                </div>
                                            }
                                        </div>

                                        <!-- Kadro Bilgileri -->
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Kadro Derecesi</label>
                                                <InputText @bind-Value="FormModel.KadroDerecesi"
                                                           class="form-control"
                                                           maxlength="50" />
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">GÃ¶reve BaÅŸlama Tarihi</label>
                                                <input type="text"
                                                       @bind="FormModel.GoreveBaslamaTarihi"
                                                       @bind:format="yyyy-MM-dd"
                                                       class="form-control flatpickr-date"
                                                       placeholder="YYYY-MM-DD" />
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">TaÅŸeron Firma</label>
                                                <InputText @bind-Value="FormModel.TaseronFirma"
                                                           class="form-control"
                                                           placeholder="TaÅŸeron firma adÄ± (varsa)"
                                                           maxlength="200" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Ä°LETÄ°ÅžÄ°M TAB -->
                            @if (ActiveTab == "iletisim")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">Ä°letiÅŸim Bilgileri</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <PermissionField FieldName="@nameof(FormModel.Email)" Context="perm">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">E-Posta</label>
                                                    <InputText @bind-Value="FormModel.Email"
                                                               class="form-control"
                                                               type="email"
                                                               disabled="@(perm.IsDisabled || IsSaving)" />
                                                </div>
                                            </PermissionField>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Dahili Tel No</label>
                                                <InputNumber @bind-Value="FormModel.Dahili"
                                                             class="form-control" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Cep Tel No 1</label>
                                                <InputText @bind-Value="FormModel.CepTelefonu"
                                                           class="form-control"
                                                           maxlength="20" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Cep Tel No 2</label>
                                                <InputText @bind-Value="FormModel.CepTelefonu2"
                                                           class="form-control"
                                                           maxlength="20" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ev Tel No</label>
                                                <InputText @bind-Value="FormModel.EvTelefonu"
                                                           class="form-control"
                                                           maxlength="20" />
                                            </div>

                                            <!-- Ä°l -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ä°l</label>
                                                <select id="ilSelect"
                                                        value="@FormModel.IlId"
                                                        @onchange="OnIlChanged"
                                                        class="form-select"
                                                        data-placeholder="Ä°l seÃ§iniz"
                                                        disabled="@IsSaving">
                                                    <option value="0">SeÃ§iniz</option>
                                                    @foreach (var il in Iller)
                                                    {
                                                        <option value="@il.IlId">@il.IlAdi</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Ä°lÃ§e -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ä°lÃ§e</label>
                                                <select id="ilceSelect"
                                                        value="@FormModel.IlceId"
                                                        @onchange="OnIlceChanged"
                                                        class="form-select"
                                                        data-placeholder="Ä°lÃ§e seÃ§iniz"
                                                        disabled="@(FormModel.IlId == 0 || IsSaving)">
                                                    <option value="0">SeÃ§iniz</option>
                                                    @foreach (var ilce in Ilceler)
                                                    {
                                                        <option value="@ilce.IlceId">@ilce.IlceAdi</option>
                                                    }
                                                </select>
                                                @if (FormModel.IlId == 0)
                                                {
                                                    <small class="text-muted">
                                                        <i class="bx bx-info-circle me-1"></i>Ã–nce il seÃ§iniz
                                                    </small>
                                                }
                                                else if (!Ilceler.Any())
                                                {
                                                    <small class="text-warning">
                                                        <i class="bx bx-error-circle me-1"></i>Bu il iÃ§in ilÃ§e bulunamadÄ±
                                                    </small>
                                                }
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Semt</label>
                                                <InputText @bind-Value="FormModel.Semt"
                                                           class="form-control"
                                                           maxlength="100" />
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label class="form-label">Adres</label>
                                                <InputTextArea @bind-Value="FormModel.Adres"
                                                               class="form-control"
                                                               rows="3"
                                                               maxlength="500" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Acil Durum YakÄ±nÄ± -->
                                <div class="card mb-4">
                                    <h5 class="card-header">Acil Durum YakÄ±nÄ±</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">YakÄ±n Ad Soyad</label>
                                                <InputText @bind-Value="FormModel.YakinAdSoyad"
                                                           class="form-control"
                                                           placeholder="Acil durumda aranacak kiÅŸi"
                                                           maxlength="100" />
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">YakÄ±nlÄ±k Derecesi</label>
                                                <InputText @bind-Value="FormModel.YakinlikDerecesi"
                                                           class="form-control"
                                                           placeholder="Ã–rn: EÅŸ, Anne, Baba, KardeÅŸ"
                                                           maxlength="50" />
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">YakÄ±n Telefonu</label>
                                                <InputText @bind-Value="FormModel.YakinTelefonu"
                                                           class="form-control"
                                                           placeholder="05XX XXX XX XX"
                                                           maxlength="20" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- KÄ°ÅžÄ°SEL TAB -->
                            @if (ActiveTab == "kisisel")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">KiÅŸisel Bilgiler</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">DoÄŸum Tarihi</label>
                                                <input type="text" @bind="FormModel.DogumTarihi" @bind:format="yyyy-MM-dd" class="form-control flatpickr-date" placeholder="YYYY-MM-DD" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Cinsiyet</label>
                                                <select id="cinsiyetSelect" @bind="FormModel.Cinsiyet" class="form-select" data-no-select2="true">
                                                    @foreach (var cinsiyet in Enum.GetValues<Cinsiyet>())
                                                    {
                                                        <option value="@cinsiyet">@GetEnumDisplayName(cinsiyet)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Medeni Durumu</label>
                                                <select id="medeniDurumuSelect" @bind="FormModel.MedeniDurumu" class="form-select" data-no-select2="true">
                                                    @foreach (var durum in Enum.GetValues<MedeniDurumu>())
                                                    {
                                                        <option value="@durum">@GetEnumDisplayName(durum)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Kan Grubu</label>
                                                <select id="kanGrubuSelect" @bind="FormModel.KanGrubu" class="form-select" data-no-select2="true">
                                                    @foreach (var kan in Enum.GetValues<KanGrubu>())
                                                    {
                                                        <option value="@kan">@GetEnumDisplayName(kan)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ev Durumu</label>
                                                <select id="evDurumuSelect" @bind="FormModel.EvDurumu" class="form-select" data-no-select2="true">
                                                    @foreach (var ev in Enum.GetValues<EvDurumu>())
                                                    {
                                                        <option value="@ev">@GetEnumDisplayName(ev)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">UlaÅŸtÄ±rma Servisi 1</label>
                                                <InputNumber @bind-Value="FormModel.UlasimServis1"
                                                             class="form-control"
                                                             min="0" />
                                                <small class="form-text text-muted">Servis numarasÄ± (0 = Yok)</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">UlaÅŸtÄ±rma Servisi 2</label>
                                                <InputNumber @bind-Value="FormModel.UlasimServis2"
                                                             class="form-control"
                                                             min="0" />
                                                <small class="form-text text-muted">Servis numarasÄ± (0 = Yok)</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Tabldot Servisi</label>
                                                <InputNumber @bind-Value="FormModel.Tabldot"
                                                             class="form-control"
                                                             min="0" />
                                                <small class="form-text text-muted">Servis numarasÄ± (0 = Yok)</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">ESHOT Hat</label>
                                                <InputText @bind-Value="FormModel.EshotHat"
                                                           class="form-control"
                                                           placeholder="ESHOT hat numarasÄ±"
                                                           maxlength="50" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Durak</label>
                                                <InputText @bind-Value="FormModel.Durak"
                                                           class="form-control"
                                                           placeholder="Ä°ndiÄŸi durak"
                                                           maxlength="100" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">PDKS Personel KayÄ±t No</label>
                                                <InputNumber @bind-Value="FormModel.PersonelKayitNo"
                                                             class="form-control"
                                                             min="0"
                                                             placeholder="PDKS personel kayÄ±t numarasÄ±" />
                                                <small class="form-text text-muted">ZKTeco cihazÄ±ndaki EnrollNumber</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">PDKS Kart No</label>
                                                <InputNumber @bind-Value="FormModel.KartNo"
                                                             class="form-control"
                                                             min="0"
                                                             placeholder="PDKS kart numarasÄ±" />
                                                <small class="form-text text-muted">ZKTeco cihazÄ±ndaki CardNumber</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Kart Aktiflik Tarihi</label>
                                                <InputDate @bind-Value="FormModel.KartNoAktiflikTarihi"
                                                           class="form-control" />
                                                <small class="form-text text-muted">Kart aktif edilme tarihi</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Ã–ZLÃœK TAB -->
                            @if (ActiveTab == "ozluk")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">Ã–zlÃ¼k Bilgileri</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ã–ÄŸrenim Durumu</label>
                                                <select id="ogrenimDurumuSelect" @bind="FormModel.OgrenimDurumu" class="form-select" data-no-select2="true">
                                                    @foreach (var ogr in Enum.GetValues<OgrenimDurumu>())
                                                    {
                                                        <option value="@ogr">@GetEnumDisplayName(ogr)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">BitirdiÄŸi Okul</label>
                                                <InputText @bind-Value="FormModel.BitirdigiOkul"
                                                           class="form-control"
                                                           maxlength="200" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">BitirdiÄŸi BÃ¶lÃ¼m</label>
                                                <InputText @bind-Value="FormModel.BitirdigiBolum"
                                                           class="form-control"
                                                           maxlength="100" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ã–ÄŸrenim SÃ¼resi (YÄ±l)</label>
                                                <InputNumber @bind-Value="FormModel.OgrenimSuresi"
                                                             class="form-control"
                                                             min="0"
                                                             max="50" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">BranÅŸÄ±</label>
                                                <InputText @bind-Value="FormModel.Bransi"
                                                           class="form-control"
                                                           maxlength="100" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Emekli Sicil No</label>
                                                <InputText @bind-Value="FormModel.EmekliSicilNo"
                                                           class="form-control"
                                                           maxlength="20" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Åžehit YakÄ±nlÄ±ÄŸÄ±</label>
                                                <select id="sehitYakinligiSelect" @bind="FormModel.SehitYakinligi" class="form-select" data-no-select2="true">
                                                    @foreach (var yakinlik in Enum.GetValues<SehitYakinligi>())
                                                    {
                                                        <option value="@yakinlik">@GetEnumDisplayName(yakinlik)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label class="form-label">IBAN</label>
                                                <InputText @bind-Value="FormModel.Iban"
                                                           class="form-control font-monospace"
                                                           placeholder="TR00 0000 0000 0000 0000 0000 00"
                                                           maxlength="34" />
                                                <small class="form-text text-muted">MaaÅŸ Ã¶demesi iÃ§in IBAN numarasÄ±</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- EÅž/Ã‡OCUK TAB -->
                            @if (ActiveTab == "es-cocuk")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">EÅŸ Bilgileri</h5>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">EÅŸ AdÄ±</label>
                                                <InputText @bind-Value="FormModel.EsininAdi" class="form-control" maxlength="100" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">EÅŸ Ä°ÅŸ Durumu</label>
                                                <select id="esininIsDurumuSelect" @bind="FormModel.EsininIsDurumu" class="form-select" data-no-select2="true">
                                                    @foreach (var durum in Enum.GetValues<EsininIsDurumu>())
                                                    {
                                                        <option value="@durum">@GetEnumDisplayName(durum)</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">EÅŸ Ä°ÅŸ ÃœnvanÄ±</label>
                                                <InputText @bind-Value="FormModel.EsininUnvani" class="form-control" maxlength="100" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">EÅŸ Ä°ÅŸ Adresi</label>
                                                <InputText @bind-Value="FormModel.EsininIsAdresi" class="form-control" maxlength="200" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Ã‡ocuk Bilgileri</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddCocuk">
                                            <i class="bx bx-plus me-1"></i>Ã‡ocuk Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Cocuklar.Any())
                                        {
                                            @foreach (var (cocuk, index) in Cocuklar.Select((c, i) => (c, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-4">
                                                        <label class="form-label small">Ä°sim</label>
                                                        <input type="text" @bind="cocuk.Isim" class="form-control form-control-sm" maxlength="100" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">DoÄŸum Tarihi</label>
                                                        <input type="text" @bind="cocuk.DogumTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label small">EÄŸitim</label>
                                                        <select @bind="cocuk.OgrenimDurumu" class="form-select form-select-sm" data-no-select2="true">
                                                            @foreach (var ogrenim in Enum.GetValues<OgrenimDurumu>())
                                                            {
                                                                <option value="@ogrenim">@GetEnumDisplayName(ogrenim)</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveCocuk(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-info mb-0">
                                                <i class="bx bx-info-circle me-2"></i>
                                                HenÃ¼z Ã§ocuk bilgisi eklenmemiÅŸ. "Ã‡ocuk Ekle" butonuna tÄ±klayarak ekleyebilirsiniz.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- HÄ°ZMET TAB -->
                            @if (ActiveTab == "hizmet")
                            {
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Ã‡alÄ±ÅŸtÄ±ÄŸÄ± Servisler</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddHizmet">
                                            <i class="bx bx-plus me-1"></i>Hizmet Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Hizmetler.Any())
                                        {
                                            @foreach (var (hizmet, index) in Hizmetler.Select((h, i) => (h, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Departman</label>
                                                        <select @bind="hizmet.DepartmanId" class="form-select form-select-sm" data-no-select2="true">
                                                            <option value="0">SeÃ§iniz...</option>
                                                            @foreach (var departman in Departmanlar)
                                                            {
                                                                <option value="@departman.DepartmanId">@departman.DepartmanAdi</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Servis</label>
                                                        <select @bind="hizmet.ServisId" class="form-select form-select-sm" data-no-select2="true">
                                                            <option value="0">SeÃ§iniz...</option>
                                                            @foreach (var servis in Servisler)
                                                            {
                                                                <option value="@servis.ServisId">@servis.ServisAdi</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">BaÅŸlama Tarihi</label>
                                                        <input type="date" @bind="hizmet.BaslamaTarihi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">AyrÄ±lma Tarihi</label>
                                                        <input type="date" @bind="hizmet.AyrilmaTarihi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Sebep</label>
                                                        <input type="text" @bind="hizmet.Sebep" class="form-control form-control-sm" maxlength="200" />
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveHizmet(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-info mb-0">
                                                <i class="bx bx-info-circle me-2"></i>
                                                HenÃ¼z hizmet bilgisi eklenmemiÅŸ.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- EÄžÄ°TÄ°M TAB -->
                            @if (ActiveTab == "egitim")
                            {
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">EÄŸitim Bilgileri</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddEgitim">
                                            <i class="bx bx-plus me-1"></i>EÄŸitim Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Egitimler.Any())
                                        {
                                            @foreach (var (egitim, index) in Egitimler.Select((e, i) => (e, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-5">
                                                        <label class="form-label small">EÄŸitim</label>
                                                        <input type="text" @bind="egitim.EgitimAdi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">BaÅŸlangÄ±Ã§ Tarihi</label>
                                                        <input type="text" @bind="egitim.BaslangicTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">BitiÅŸ Tarihi</label>
                                                        <input type="text" @bind="egitim.BitisTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveEgitim(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-info mb-0">
                                                <i class="bx bx-info-circle me-2"></i>
                                                HenÃ¼z eÄŸitim bilgisi eklenmemiÅŸ.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- YETKÄ° TAB -->
                            @if (ActiveTab == "yetki")
                            {
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Ä°mza Yetkileri</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddYetki">
                                            <i class="bx bx-plus me-1"></i>Yetki Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Yetkiler.Any())
                                        {
                                            @foreach (var (yetki, index) in Yetkiler.Select((y, i) => (y, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Departman</label>
                                                        <select @bind="yetki.DepartmanId" class="form-select form-select-sm" data-no-select2="true">
                                                            <option value="0">SeÃ§iniz</option>
                                                            @foreach (var departman in Departmanlar)
                                                            {
                                                                <option value="@departman.DepartmanId">@departman.DepartmanAdi</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Servis</label>
                                                        <select @bind="yetki.ServisId" class="form-select form-select-sm" data-no-select2="true">
                                                            <option value="0">SeÃ§iniz</option>
                                                            @foreach (var servis in Servisler)
                                                            {
                                                                <option value="@servis.ServisId">@servis.ServisAdi</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">GÃ¶rev DeÄŸiÅŸim Sebebi</label>
                                                        <input type="text" @bind="yetki.GorevDegisimSebebi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">BaÅŸlama Tarihi</label>
                                                        <input type="text" @bind="yetki.ImzaYetkisiBaslamaTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">BitiÅŸ Tarihi</label>
                                                        <input type="text" @bind="yetki.ImzaYetkisiBitisTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveYetki(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-info mb-0">
                                                <i class="bx bx-info-circle me-2"></i>
                                                HenÃ¼z yetki bilgisi eklenmemiÅŸ.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- CEZA TAB -->
                            @if (ActiveTab == "ceza")
                            {
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Ceza Bilgileri</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddCeza">
                                            <i class="bx bx-plus me-1"></i>Ceza Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Cezalar.Any())
                                        {
                                            @foreach (var (ceza, index) in Cezalar.Select((c, i) => (c, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-5">
                                                        <label class="form-label small">Ceza Sebebi</label>
                                                        <input type="text" @bind="ceza.CezaSebebi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Alt Bendi</label>
                                                        <input type="text" @bind="ceza.AltBendi" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Ceza Tarihi</label>
                                                        <input type="text" @bind="ceza.CezaTarihi" @bind:format="yyyy-MM-dd" class="form-control form-control-sm flatpickr-date" placeholder="YYYY-MM-DD" />
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveCeza(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-success mb-0">
                                                <i class="bx bx-check-circle me-2"></i>
                                                Personelin ceza kaydÄ± bulunmamaktadÄ±r.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- ENGEL TAB -->
                            @if (ActiveTab == "engel")
                            {
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Engel Bilgileri</h5>
                                        <button type="button" class="btn btn-sm btn-primary" @onclick="AddEngel">
                                            <i class="bx bx-plus me-1"></i>Engel Ekle
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        @if (Engeller.Any())
                                        {
                                            @foreach (var (engel, index) in Engeller.Select((e, i) => (e, i)))
                                            {
                                                <div class="row mb-3 pb-3 border-bottom">
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Engel Derecesi</label>
                                                        <select @bind="engel.EngelDerecesi" class="form-select form-select-sm" data-no-select2="true">
                                                            @foreach (var derece in Enum.GetValues<EngelDerecesi>())
                                                            {
                                                                <option value="@derece">@derece</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Engel Nedeni 1</label>
                                                        <input type="text" @bind="engel.EngelNedeni1" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Engel Nedeni 2</label>
                                                        <input type="text" @bind="engel.EngelNedeni2" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Engel Nedeni 3</label>
                                                        <input type="text" @bind="engel.EngelNedeni3" class="form-control form-control-sm" />
                                                    </div>
                                                    <div class="col-md-1 d-flex align-items-end">
                                                        <button type="button" class="btn btn-sm btn-danger w-100" @onclick="() => RemoveEngel(index)">
                                                            <i class="bx bx-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="alert alert-info mb-0">
                                                <i class="bx bx-info-circle me-2"></i>
                                                Engel bilgisi bulunmamaktadÄ±r.
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- FOTOÄžRAF TAB -->
                            @if (ActiveTab == "fotograf")
                            {
                                <div class="card mb-4">
                                    <h5 class="card-header">FotoÄŸraf</h5>
                                    <div class="card-body">
                                        <div class="text-center mb-4">
                                            @if (!string.IsNullOrEmpty(FormModel.Resim))
                                            {
                                                <CachedImage @key="@FormModel.Resim" Src="@FormModel.Resim" Alt="Personel FotoÄŸrafÄ±" Class="img-fluid rounded mb-3" Style="max-width: 300px; max-height: 300px; object-fit: cover;" />
                                            }
                                            else
                                            {
                                                <div class="avatar avatar-xl mb-3 mx-auto" style="width: 150px; height: 150px;">
                                                    <span class="avatar-initial rounded bg-label-primary" style="font-size: 4rem;">
                                                        @(string.IsNullOrEmpty(FormModel.AdSoyad) ? "?" : FormModel.AdSoyad.Substring(0, 1).ToUpper())
                                                    </span>
                                                </div>
                                            }
                                        </div>

                                        <!-- Dosya YÃ¼kleme -->
                                        <div class="mb-3">
                                            <label class="form-label">FotoÄŸraf YÃ¼kle</label>
                                            <InputFile OnChange="HandleFileSelected" 
                                                       class="form-control"
                                                       accept="image/*" />
                                            <small class="form-text text-muted">
                                                <i class="bx bx-info-circle me-1"></i>
                                                Maksimum dosya boyutu: 2MB. Desteklenen formatlar: JPG, JPEG, PNG, GIF, BMP, WEBP
                                            </small>
                                        </div>

                                        @if (IsUploadingImage)
                                        {
                                            <div class="alert alert-info">
                                                <div class="d-flex align-items-center">
                                                    <div class="spinner-border spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">YÃ¼kleniyor...</span>
                                                    </div>
                                                    <span>FotoÄŸraf yÃ¼kleniyor...</span>
                                                </div>
                                            </div>
                                        }

                                        @if (!string.IsNullOrEmpty(UploadErrorMessage))
                                        {
                                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <i class="bx bx-error-circle me-2"></i>
                                                @UploadErrorMessage
                                                <button type="button" class="btn-close" @onclick="() => UploadErrorMessage = string.Empty"></button>
                                            </div>
                                        }

                                        <div class="border-top pt-3 mt-3">
                                            <div class="mb-3">
                                                <label class="form-label">veya FotoÄŸraf URL</label>
                                                <InputText @bind-Value="FormModel.Resim"
                                                           class="form-control"
                                                           placeholder="https://example.com/photo.jpg" />
                                                <small class="form-text text-muted">
                                                    <i class="bx bx-link me-1"></i>
                                                    Harici bir URL'den fotoÄŸraf ekleyebilirsiniz
                                                </small>
                                            </div>
                                        </div>

                                        @if (!string.IsNullOrEmpty(FormModel.Resim))
                                        {
                                            <div class="d-flex gap-2 justify-content-center mt-3">
                                                <button type="button" class="btn btn-outline-danger btn-sm" @onclick="RemovePhoto" disabled="@(!CanEditPage || IsSaving)">
                                                    <i class="bx bx-trash me-1"></i>FotoÄŸrafÄ± KaldÄ±r
                                                </button>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- KAYDET BUTONU -->
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex gap-2 justify-content-end">
                                        <button type="button" class="btn btn-outline-secondary" @onclick="NavigateToPersonelList" disabled="@IsSaving">
                                            Ä°ptal
                                        </button>
                                        <button type="submit" class="btn btn-primary" disabled="@IsSaving">
                                            @if (IsSaving)
                                            {
                                                <span class="spinner-border spinner-border-sm me-1"></span>
                                            }
                                            <i class="bx bx-save me-1"></i>
                                            @(IsEditMode ? "GÃ¼ncelle" : "Kaydet")
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                                </div>
                            </EditForm>
                        </CascadingValue>
                }
            }
        </div>
    </FieldPermissionScope>
}