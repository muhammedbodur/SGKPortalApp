@page "/personel"
@inherits SGKPortalApp.PresentationLayer.Components.Base.FieldPermissionPageBase
@using SGKPortalApp.BusinessObjectLayer.DTOs.Response.PersonelIslemleri
@using SGKPortalApp.BusinessObjectLayer.Enums.Common
@using SGKPortalApp.BusinessObjectLayer.Enums.PersonelIslemleri
@using static SGKPortalApp.BusinessObjectLayer.Enums.PersonelIslemleri.PersonelAktiflikDurumExtensions
@using SGKPortalApp.PresentationLayer.Components.Permission
@using SGKPortalApp.PresentationLayer.Components.Common

<PageTitle>Personel Yönetimi - SGK Portal</PageTitle>
@if (!CanViewPage)
{
    <div class="alert alert-danger" role="alert">
        <i class="bx bx-lock-alt me-2"></i>
        Bu sayfayı görüntüleme yetkiniz bulunmuyor.
    </div>
}
else
{
    <FieldPermissionScope PageKey="@ResolvedPermissionKey" IsEditMode="true">
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- PAGE HEADER -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <div class="container-xxl flex-grow-1 container-p-y">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="fw-bold mb-1">
                        <i class="bx bx-user me-2"></i>Personel Yönetimi
                    </h4>
                    <p class="text-muted mb-0">
                        Tüm personelleri görüntüleyin ve yönetin
                    </p>
                </div>

                <div class="d-flex gap-2">
                    <ExportButton ExportType="ExportType.Excel"
                                  OnClick="ExportToExcel"
                                  IsExporting="@IsExporting"
                                  CurrentExportType="@CurrentExportType" />

                    <ExportButton ExportType="ExportType.PDF"
                                  OnClick="ExportToPdf"
                                  IsExporting="@IsExporting"
                                  CurrentExportType="@CurrentExportType" />

                    <button class="btn btn-primary" @onclick="GoToManagePage">
                        <i class="bx bx-user-plus me-1"></i> Yeni Personel Ekle
                    </button>
                </div>
            </div>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!-- FILTER CARD -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row g-3">
                        <!-- TC Kimlik / Sicil / Ad Soyad Arama -->
                        <div class="col-md-3">
                            <label class="form-label">TC / Sicil / Ad Soyad</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bx bx-search"></i>
                                </span>
                                <input type="text"
                                       class="form-control"
                                       placeholder="Ara..."
                                       @bind="searchTerm"
                                       @bind:event="oninput"
                                       @onkeyup="OnSearchChanged" />
                            </div>
                        </div>

                        <!-- Departman Filtresi -->
                        @if (IsFieldVisibleInList("DEPARTMANID"))
                        {
                            <div class="col-md-2">
                                <label class="form-label">
                                    <i class="bx bx-briefcase me-1"></i>Departman
                                    @if (!CanEditFieldInList("DEPARTMANID"))
                                    {
                                        <span class="badge bg-label-warning ms-1" title="Sadece görüntüleme yetkiniz var">
                                            <i class="bx bx-lock-alt"></i>
                                        </span>
                                    }
                                </label>
                                <select class="form-select" value="@filterDepartmanId" @onchange="OnFilterDepartmanChanged" disabled="@IsFieldDisabledInList("DEPARTMANID")">
                                    <option value="0">Tümü</option>
                                    @foreach (var dept in Departmanlar)
                                    {
                                        <option value="@dept.DepartmanId">@dept.DepartmanAdi</option>
                                    }
                                </select>
                            </div>
                        }

                        <!-- Servis Filtresi -->
                        @if (IsFieldVisibleInList("SERVISID"))
                        {
                            <div class="col-md-2">
                                <label class="form-label">
                                    <i class="bx bx-sitemap me-1"></i>Servis
                                    @if (!CanEditFieldInList("SERVISID"))
                                    {
                                        <span class="badge bg-label-warning ms-1" title="Sadece görüntüleme yetkiniz var">
                                            <i class="bx bx-lock-alt"></i>
                                        </span>
                                    }
                                </label>
                                <select class="form-select" value="@filterServisId" @onchange="OnFilterServisChanged" disabled="@IsFieldDisabledInList("SERVISID")">
                                    <option value="0">Tümü</option>
                                    @foreach (var servis in Servisler)
                                    {
                                        <option value="@servis.ServisId">@servis.ServisAdi</option>
                                    }
                                </select>
                            </div>
                        }

                        <!-- Hizmet Binası Filtresi -->
                        @if (IsFieldVisibleInList("HIZMETBINASIID"))
                        {
                            <div class="col-md-2">
                                <label class="form-label">
                                    <i class="bx bx-building me-1"></i>Hizmet Binası
                                    @if (!CanEditFieldInList("HIZMETBINASIID"))
                                    {
                                        <span class="badge bg-label-warning ms-1" title="Sadece görüntüleme yetkiniz var">
                                            <i class="bx bx-lock-alt"></i>
                                        </span>
                                    }
                                </label>
                                <select class="form-select" value="@filterHizmetBinasiId" @onchange="OnFilterHizmetBinasiChanged" disabled="@IsFieldDisabledInList("HIZMETBINASIID")">
                                    <option value="0">Tümü</option>
                                    @foreach (var bina in HizmetBinalari)
                                    {
                                        <option value="@bina.HizmetBinasiId">@bina.HizmetBinasiAdi</option>
                                    }
                                </select>
                            </div>
                        }

                        <!-- Ünvan Filtresi -->
                        <div class="col-md-2">
                            <label class="form-label">Ünvan</label>
                            <select class="form-select" value="@filterUnvanId" @onchange="OnFilterUnvanChanged">
                                <option value="0">Tümü</option>
                                @foreach (var unvan in Unvanlar)
                                {
                                    <option value="@unvan.UnvanId">@unvan.UnvanAdi</option>
                                }
                            </select>
                        </div>

                        <!-- Aktiflik Filtresi -->
                        <div class="col-md-2">
                            <label class="form-label">Aktiflik</label>
                            <select class="form-select" value="@filterAktiflik" @onchange="OnFilterAktiflikChanged">
                                <option value="-1">Tümü</option>
                                <option value="1">Aktif</option>
                                <option value="0">Pasif</option>
                                <option value="2">Emekli</option>
                            </select>
                        </div>
                    </div>

                    <!-- İstatistikler -->
                    <div class="row mt-3">
                        <div class="col">
                            <div class="d-flex gap-4 text-muted small">
                                <span>
                                    <i class="bx bx-user text-primary"></i>
                                    Toplam Kayıt: <strong>@TotalCount</strong>
                                </span>
                                <span>
                                    <i class="bx bx-file text-info"></i>
                                    Bu Sayfada: <strong>@FilteredPersoneller.Count</strong>
                                </span>
                                <span>
                                    <i class="bx bx-sort text-secondary"></i>
                                    Sıralama: <strong>@GetSortDisplayName()</strong>
                                </span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm btn-outline-secondary" @onclick="ClearFilters">
                                <i class="bx bx-reset me-1"></i>Temizle
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!-- TABLE CARD -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <div class="card">
                <div class="card-body">
                    @if (IsLoading)
                    {
                        <!-- Loading Spinner -->
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Yükleniyor...</span>
                            </div>
                            <p class="mt-2 text-muted">Personeller yükleniyor...</p>
                        </div>
                    }
                    else if (!FilteredPersoneller.Any())
                    {
                        <!-- Empty State -->
                        <div class="text-center py-5">
                            <i class="bx bx-search-alt display-1 text-muted"></i>
                            <h5 class="mt-3">Personel Bulunamadı</h5>
                            <p class="text-muted">
                                @if (string.IsNullOrEmpty(searchTerm) && filterDepartmanId == 0 && filterServisId == 0)
                                {
                                    <span>Henüz personel eklenmemiş.</span>
                                }
                                else
                                {
                                    <span>Arama kriterlerinize uygun personel bulunamadı.</span>
                                }
                            </p>
                            <button class="btn btn-primary mt-2" @onclick="OpenQuickAddModal">
                                <i class="bx bx-plus me-1"></i>İlk Personeli Ekle
                            </button>
                        </div>
                    }
                    else
                    {
                        <!-- Toplu İşlemler Toolbar -->
                        @if (SelectedPersonelIds.Any())
                        {
                            <div class="alert alert-info d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <i class="bx bx-check-circle me-2"></i>
                                    <strong>@SelectedPersonelIds.Count</strong> personel seçildi
                                </div>
                                <div class="btn-group">
                                    @if (filterZKTecoDeviceId > 0)
                                    {
                                        <button class="btn btn-sm btn-primary" @onclick="SendSelectedToDevice">
                                            <i class="bx bx-upload me-1"></i>Seçili Cihaza Gönder
                                        </button>
                                    }
                                    <button class="btn btn-sm btn-success" @onclick="SendSelectedToAllDevices">
                                        <i class="bx bx-devices me-1"></i>Tüm Cihazlara Gönder
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" @onclick="ClearSelection">
                                        <i class="bx bx-x me-1"></i>Seçimi Temizle
                                    </button>
                                </div>
                            </div>
                        }

                        <!-- Table -->
                        <div class="table-container">
                            <table class="table table-hover table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 40px; padding: 0.5rem 0.25rem;">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   @onchange="ToggleSelectAll"
                                                   checked="@IsAllSelected" />
                                        </th>
                                        <th style="width: 40px; padding: 0.5rem 0.25rem;">#</th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByTc" @onclick:stopPropagation="true">
                                            TC Kimlik No
                                            @if (sortBy == "tc-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "tc-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortBySicil" @onclick:stopPropagation="true">
                                            Sicil No
                                            @if (sortBy == "sicil-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "sicil-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByName" @onclick:stopPropagation="true">
                                            Ad Soyad
                                            @if (sortBy == "name-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "name-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByDepartman" @onclick:stopPropagation="true">
                                            Departman
                                            @if (sortBy == "dept-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "dept-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByServis" @onclick:stopPropagation="true">
                                            Servis
                                            @if (sortBy == "servis-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "servis-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByBina" @onclick:stopPropagation="true">
                                            Hizmet Binası
                                            @if (sortBy == "bina-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "bina-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th style="padding: 0.5rem; cursor: pointer;" @onclick="SortByUnvan" @onclick:stopPropagation="true">
                                            Ünvan
                                            @if (sortBy == "unvan-asc") { <i class="bx bx-chevron-up ms-1"></i> }
                                            else if (sortBy == "unvan-desc") { <i class="bx bx-chevron-down ms-1"></i> }
                                        </th>
                                        <th class="text-center" style="width: 80px; padding: 0.5rem 0.25rem;">Durum</th>
                                        <th class="text-center" style="width: 120px; padding: 0.5rem 0.25rem;">İşlemler</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var (personel, index) in FilteredPersoneller.Select((p, i) => (p, i)))
                                    {
                                        <tr style="@GetClickableRowStyle(ActionType.DETAIL)" @onclick="() => TryNavigateToDetail(personel.TcKimlikNo)">
                                            <td style="padding: 0.35rem 0.25rem; font-size: 0.875rem;" @onclick:stopPropagation="true">
                                                <input type="checkbox"
                                                       class="form-check-input"
                                                       checked="@SelectedPersonelIds.Contains(personel.TcKimlikNo)"
                                                       @onchange="() => TogglePersonelSelection(personel.TcKimlikNo)" />
                                            </td>
                                            <td style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@((CurrentPage - 1) * PageSize + index + 1)</td>
                                            <td style="padding: 0.35rem 0.25rem; font-size: 0.875rem; white-space: nowrap;">
                                                <PersonelHoverCard Personel="@personel" PermissionKey="PER.PERSONEL.INDEX.COMPONENT.HOVERCARD">
                                                    <span class="fw-medium text-primary" style="cursor: pointer;">@personel.TcKimlikNo</span>
                                                </PersonelHoverCard>
                                            </td>
                                            <td class="text-break" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@personel.SicilNo</td>
                                            <td style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">
                                                <div class="d-flex align-items-center avatar-offline">
                                                    @if (!string.IsNullOrEmpty(personel.Resim))
                                                    {
                                                        <CachedImage @key="@personel.Resim" Src="@personel.Resim" Alt="avatar" Class="rounded-circle me-1" Width="40" Height="40" />
                                                    }
                                                    else
                                                    {
                                                        <div class="avatar avatar-sm me-1" style="width: 28px; height: 28px;">
                                                            <span class="avatar-initial rounded-circle bg-label-primary" style="font-size: 0.75rem;">
                                                                @personel.AdSoyad.Substring(0, 1).ToUpper()
                                                            </span>
                                                        </div>
                                                    }
                                                    <div>
                                                        <span class="fw-medium">@personel.AdSoyad</span>
                                                        @if (!string.IsNullOrEmpty(personel.Email))
                                                        {
                                                            <br /><a href="mailto:@personel.Email" class="text-muted" style="font-size: 0.75rem; text-decoration: none;" ondblclick="event.preventDefault(); window.location.href='mailto:@personel.Email';">@personel.Email</a>
                                                        }
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-break" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@personel.DepartmanAdi</td>
                                            <td class="text-break" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@personel.ServisAdi</td>
                                            <td class="text-break" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@personel.HizmetBinasiAdi</td>
                                            <td class="text-break" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">@personel.UnvanAdi</td>
                                            <td class="text-center" style="padding: 0.35rem 0.25rem; font-size: 0.875rem;">
                                                <span class="badge @personel.PersonelAktiflikDurum.GetBadgeClass()">
                                                    <i class="@personel.PersonelAktiflikDurum.GetIconClass() me-1"></i>@GetEnumDisplayName(personel.PersonelAktiflikDurum)
                                                </span>
                                            </td>
                                            <td class="text-center">
                                                <div class="d-flex justify-content-center gap-1">
                                                    <ActionButton ActionType="ActionType.DETAIL"
                                                                  IsVisible="@IsActionVisible(ActionType.DETAIL)"
                                                                  IsEnabled="@CanAction(ActionType.DETAIL)"
                                                                  OnClick="() => NavigateToDetail(personel.TcKimlikNo)" />

                                                    <ActionButton ActionType="ActionType.EDIT"
                                                                  IsVisible="@IsActionVisible(ActionType.EDIT)"
                                                                  IsEnabled="@CanEditAction(ActionType.EDIT)"
                                                                  OnClick="() => NavigateToEdit(personel.TcKimlikNo)" />

                                                    <ActionButton ActionType="ActionType.DELETE"
                                                                  IsVisible="@IsActionVisible(ActionType.DELETE)"
                                                                  IsEnabled="@CanEditAction(ActionType.DELETE)"
                                                                  OnClick="() => OpenDeleteModal(personel)" />

                                                    <!-- ZKTeco PDKS İşlemleri Dropdown -->
                                                    <div class="btn-group" @onclick:stopPropagation="true">
                                                        <button type="button"
                                                                class="btn btn-sm btn-outline-primary dropdown-toggle"
                                                                data-bs-toggle="dropdown"
                                                                aria-expanded="false"
                                                                title="PDKS İşlemleri">
                                                            <i class="bx bx-devices"></i>
                                                        </button>
                                                        <ul class="dropdown-menu">
                                                            <li><h6 class="dropdown-header">Cihaza Gönder</h6></li>
                                                            @if (filterZKTecoDeviceId > 0)
                                                            {
                                                                <li>
                                                                    <a class="dropdown-item" href="javascript:void(0)" @onclick="() => SendToSelectedDevice(personel)">
                                                                        <i class="bx bx-upload me-2"></i>Seçili Cihaza Gönder
                                                                    </a>
                                                                </li>
                                                            }
                                                            <li>
                                                                <a class="dropdown-item" href="javascript:void(0)" @onclick="() => SendToAllDevices(personel)">
                                                                    <i class="bx bx-devices me-2"></i>Tüm Cihazlara Gönder
                                                                </a>
                                                            </li>
                                                            <li><hr class="dropdown-divider"></li>
                                                            <li><h6 class="dropdown-header">Cihazdan Sil</h6></li>
                                                            @if (filterZKTecoDeviceId > 0)
                                                            {
                                                                <li>
                                                                    <a class="dropdown-item text-warning" href="javascript:void(0)" @onclick="() => DeleteFromSelectedDevice(personel)">
                                                                        <i class="bx bx-trash me-2"></i>Seçili Cihazdan Sil
                                                                    </a>
                                                                </li>
                                                            }
                                                            <li>
                                                                <a class="dropdown-item text-danger" href="javascript:void(0)" @onclick="() => DeleteFromAllDevices(personel)">
                                                                    <i class="bx bx-trash-alt me-2"></i>Tüm Cihazlardan Sil
                                                                </a>
                                                            </li>
                                                            <li><hr class="dropdown-divider"></li>
                                                            <li>
                                                                <a class="dropdown-item" href="javascript:void(0)" @onclick="() => EditCardNumber(personel)">
                                                                    <i class="bx bx-edit me-2"></i>Kart No Düzenle
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        @if (TotalPages > 1)
                        {
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div class="d-flex align-items-center gap-2">
                                    <label class="text-muted small mb-0">Sayfa boyutu:</label>
                                    <select class="form-select form-select-sm" style="width: 80px;" @onchange="OnPageSizeChanged">
                                        <option value="10" selected="@(PageSize == 10)">10</option>
                                        <option value="25" selected="@(PageSize == 25)">25</option>
                                        <option value="50" selected="@(PageSize == 50)">50</option>
                                        <option value="100" selected="@(PageSize == 100)">100</option>
                                    </select>
                                    <span class="text-muted small">
                                        Gösterilen: @((CurrentPage - 1) * PageSize + 1) - @Math.Min(CurrentPage * PageSize, TotalCount) / @TotalCount
                                    </span>
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm mb-0">
                                        <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                                            <button class="page-link" @onclick="() => _ = ChangePage(CurrentPage - 1)">
                                                <i class="bx bx-chevron-left"></i>
                                            </button>
                                        </li>

                                        @for (int i = Math.Max(1, CurrentPage - 2); i <= Math.Min(TotalPages, CurrentPage + 2); i++)
                                        {
                                            var pageNum = i;
                                            <li class="page-item @(CurrentPage == pageNum ? "active" : "")">
                                                <button class="page-link" @onclick="() => _ = ChangePage(pageNum)">@pageNum</button>
                                            </li>
                                        }

                                        <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                                            <button class="page-link" @onclick="() => _ = ChangePage(CurrentPage + 1)">
                                                <i class="bx bx-chevron-right"></i>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </FieldPermissionScope>
}

<!-- ═══════════════════════════════════════════════════════ -->
<!-- DELETE MODAL -->
<!-- ═══════════════════════════════════════════════════════ -->
@if (ShowDeleteModal)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white">
                        <i class="bx bx-trash me-2"></i>Personel Sil
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseDeleteModal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bx bx-error-circle display-1 text-danger"></i>
                    </div>
                    <h6 class="text-center mb-3">Bu personeli silmek istediğinizden emin misiniz?</h6>
                    <div class="alert alert-warning">
                        <strong>@DeletePersonelAdSoyad</strong> (@DeletePersonelTcKimlik)
                    </div>
                    <p class="text-muted small mb-0">
                        <i class="bx bx-info-circle me-1"></i>
                        Bu işlem geri alınamaz!
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" @onclick="CloseDeleteModal" disabled="@IsDeleting">
                        İptal
                    </button>
                    <button type="button" class="btn btn-danger" @onclick="ConfirmDelete" disabled="@IsDeleting">
                        @if (IsDeleting)
                        {
                            <span class="spinner-border spinner-border-sm me-1"></span>
                        }
                        Evet, Sil
                    </button>
                </div>
            </div>
        </div>
    </div>
}

<!-- ═══════════════════════════════════════════════════════ -->
<!-- EDIT CARD NUMBER MODAL -->
<!-- ═══════════════════════════════════════════════════════ -->
@if (ShowEditCardModal && EditingPersonel != null)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white">
                        <i class="bx bx-credit-card me-2"></i>Kart No Düzenle
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseEditCardModal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="alert alert-info">
                            <strong>@EditingPersonel.AdSoyad</strong>
                            <br />
                            <small class="text-muted">TC: @EditingPersonel.TcKimlikNo | Sicil: @EditingPersonel.SicilNo</small>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Kart Numarası</label>
                        <input type="number"
                               class="form-control"
                               @bind="EditCardNumberValue"
                               placeholder="Kart numarasını giriniz"
                               min="0" />
                        <small class="text-muted">
                            <i class="bx bx-info-circle me-1"></i>
                            Mevcut Kart No: @EditingPersonel.KartNo
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" @onclick="CloseEditCardModal" disabled="@IsEditingCard">
                        İptal
                    </button>
                    <button type="button" class="btn btn-primary" @onclick="SaveCardNumber" disabled="@IsEditingCard">
                        @if (IsEditingCard)
                        {
                            <span class="spinner-border spinner-border-sm me-1"></span>
                        }
                        <i class="bx bx-save me-1"></i>Kaydet
                    </button>
                </div>
            </div>
        </div>
    </div>
}
