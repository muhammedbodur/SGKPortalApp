@page "/hesap/sifre-degistir"
@page "/account/change-password"
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>Şifre Değiştir - SGK Portal</PageTitle>

<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Hesap /</span> Şifre Değiştir
    </h4>

    <div class="row justify-content-center">
        <div class="col-xl-6 col-lg-8 col-md-10">
            <div class="card">
                <div class="card-header text-center pb-0 pt-4">
                    <div class="avatar avatar-lg mx-auto mb-3" style="width: 80px; height: 80px;">
                        <span class="avatar-initial rounded-circle bg-label-primary" style="width: 80px; height: 80px; line-height: 80px; font-size: 2rem;">
                            <i class="bx bx-lock-alt"></i>
                        </span>
                    </div>
                    <h5 class="mb-1">Şifre Değiştir</h5>
                    <p class="text-muted small">Güvenliğiniz için güçlü bir şifre seçin</p>
                </div>
                <div class="card-body pt-3">
                    @if (ShowSuccessMessage)
                    {
                        <div class="alert alert-success d-flex align-items-center" role="alert">
                            <i class="bx bx-check-circle fs-4 me-2"></i>
                            <div>
                                <strong>Şifreniz başarıyla değiştirildi!</strong>
                                <p class="mb-0 small">Yeni şifrenizle giriş yapabilirsiniz.</p>
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(ErrorMessage))
                    {
                        <div class="alert alert-danger d-flex align-items-center" role="alert">
                            <i class="bx bx-error-circle fs-4 me-2"></i>
                            <div>@ErrorMessage</div>
                        </div>
                    }

                    <EditForm Model="Model" OnValidSubmit="HandleSubmit">
                        <DataAnnotationsValidator />

                        <!-- Mevcut Şifre -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">
                                <i class="bx bx-key me-1 text-muted"></i>
                                Mevcut Şifre
                            </label>
                            <div class="input-group input-group-merge">
                                <InputText @bind-Value="Model.CurrentPassword"
                                           type="@(ShowCurrentPassword ? "text" : "password")"
                                           class="form-control"
                                           placeholder="Mevcut şifrenizi girin" />
                                <span class="input-group-text cursor-pointer" @onclick="() => ShowCurrentPassword = !ShowCurrentPassword">
                                    <i class="bx @(ShowCurrentPassword ? "bx-show" : "bx-hide")"></i>
                                </span>
                            </div>
                            <ValidationMessage For="@(() => Model.CurrentPassword)" class="text-danger small" />
                        </div>

                        <!-- Yeni Şifre -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">
                                <i class="bx bx-lock-alt me-1 text-muted"></i>
                                Yeni Şifre
                            </label>
                            <div class="input-group input-group-merge">
                                <InputText @bind-Value="Model.NewPassword"
                                           type="@(ShowNewPassword ? "text" : "password")"
                                           class="form-control"
                                           placeholder="Yeni şifrenizi girin"
                                           @oninput="CheckPasswordStrength" />
                                <span class="input-group-text cursor-pointer" @onclick="() => ShowNewPassword = !ShowNewPassword">
                                    <i class="bx @(ShowNewPassword ? "bx-show" : "bx-hide")"></i>
                                </span>
                            </div>
                            <ValidationMessage For="@(() => Model.NewPassword)" class="text-danger small" />

                            <!-- Şifre Güç Göstergesi -->
                            <div class="mt-2">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <small class="text-muted">Şifre Gücü</small>
                                    <small class="fw-semibold text-@PasswordStrengthColor">@PasswordStrengthText</small>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-@PasswordStrengthColor"
                                         role="progressbar"
                                         style="width: @PasswordStrengthPercent%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Şifre Tekrar -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bx bx-check-shield me-1 text-muted"></i>
                                Yeni Şifre (Tekrar)
                            </label>
                            <div class="input-group input-group-merge">
                                <InputText @bind-Value="Model.ConfirmPassword"
                                           type="@(ShowConfirmPassword ? "text" : "password")"
                                           class="form-control"
                                           placeholder="Yeni şifrenizi tekrar girin" />
                                <span class="input-group-text cursor-pointer" @onclick="() => ShowConfirmPassword = !ShowConfirmPassword">
                                    <i class="bx @(ShowConfirmPassword ? "bx-show" : "bx-hide")"></i>
                                </span>
                            </div>
                            <ValidationMessage For="@(() => Model.ConfirmPassword)" class="text-danger small" />
                            @if (!string.IsNullOrEmpty(Model.NewPassword) && !string.IsNullOrEmpty(Model.ConfirmPassword))
                            {
                                @if (Model.NewPassword == Model.ConfirmPassword)
                                {
                                    <small class="text-success"><i class="bx bx-check me-1"></i>Şifreler eşleşiyor</small>
                                }
                                else
                                {
                                    <small class="text-danger"><i class="bx bx-x me-1"></i>Şifreler eşleşmiyor</small>
                                }
                            }
                        </div>

                        <!-- Şifre Gereksinimleri -->
                        <div class="alert alert-light mb-4">
                            <h6 class="alert-heading mb-2">
                                <i class="bx bx-info-circle me-1"></i>
                                Şifre Gereksinimleri
                            </h6>
                            <ul class="list-unstyled mb-0 small">
                                <li class="@(HasMinLength ? "text-success" : "text-muted")">
                                    <i class="bx @(HasMinLength ? "bx-check" : "bx-circle") me-1"></i>
                                    En az 8 karakter
                                </li>
                                <li class="@(HasUpperCase ? "text-success" : "text-muted")">
                                    <i class="bx @(HasUpperCase ? "bx-check" : "bx-circle") me-1"></i>
                                    En az bir büyük harf (A-Z)
                                </li>
                                <li class="@(HasLowerCase ? "text-success" : "text-muted")">
                                    <i class="bx @(HasLowerCase ? "bx-check" : "bx-circle") me-1"></i>
                                    En az bir küçük harf (a-z)
                                </li>
                                <li class="@(HasDigit ? "text-success" : "text-muted")">
                                    <i class="bx @(HasDigit ? "bx-check" : "bx-circle") me-1"></i>
                                    En az bir rakam (0-9)
                                </li>
                                <li class="@(HasSpecialChar ? "text-success" : "text-muted")">
                                    <i class="bx @(HasSpecialChar ? "bx-check" : "bx-circle") me-1"></i>
                                    En az bir özel karakter (!@@#$%^&*)
                                </li>
                            </ul>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" disabled="@(IsSubmitting || !IsFormValid)">
                                @if (IsSubmitting)
                                {
                                    <span class="spinner-border spinner-border-sm me-2"></span>
                                    <span>İşleniyor...</span>
                                }
                                else
                                {
                                    <i class="bx bx-check me-1"></i>
                                    <span>Şifreyi Değiştir</span>
                                }
                            </button>
                            <a href="/hesap/profil" class="btn btn-outline-secondary">
                                <i class="bx bx-arrow-back me-1"></i>
                                Profile Dön
                            </a>
                        </div>
                    </EditForm>
                </div>
            </div>

            <!-- Güvenlik İpuçları -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bx bx-shield-quarter text-warning me-2"></i>
                        Güvenlik İpuçları
                    </h6>
                    <ul class="list-unstyled mb-0 small text-muted">
                        <li class="mb-2">
                            <i class="bx bx-check-circle text-success me-2"></i>
                            Şifrenizi kimseyle paylaşmayın
                        </li>
                        <li class="mb-2">
                            <i class="bx bx-check-circle text-success me-2"></i>
                            Farklı hesaplarınız için farklı şifreler kullanın
                        </li>
                        <li class="mb-2">
                            <i class="bx bx-check-circle text-success me-2"></i>
                            Şifrenizi düzenli aralıklarla değiştirin
                        </li>
                        <li>
                            <i class="bx bx-check-circle text-success me-2"></i>
                            Şüpheli aktivite fark ederseniz derhal şifrenizi değiştirin
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .cursor-pointer {
        cursor: pointer;
    }
    .input-group-merge .form-control:focus {
        border-color: #696cff;
    }
    .input-group-merge .input-group-text {
        border-left: none;
    }
</style>

