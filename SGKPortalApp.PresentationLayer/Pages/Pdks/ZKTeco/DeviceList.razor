@page "/pdks/zkteco/devices"
@using SGKPortalApp.BusinessObjectLayer.Entities.ZKTeco
@using System.Net.Http.Json
@inject HttpClient Http
@inject IConfiguration Configuration
@inject IJSRuntime JS

<PageTitle>ZKTeco Cihaz Y√∂netimi</PageTitle>

<div class="container-fluid">
    <div class="row mb-3">
        <div class="col">
            <h3>üì± ZKTeco Cihaz Y√∂netimi</h3>
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" @onclick="ToggleAddForm">
                <i class="bx bx-plus"></i> @(showAddForm ? "Formu Kapat" : "Yeni Cihaz")
            </button>
        </div>
    </div>

    @if (showAddForm)
    {
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Yeni Cihaz Ekle</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Cihaz Adƒ± *</label>
                        <input type="text" class="form-control" @bind="newDevice.DeviceName" placeholder="Ana Giri≈ü Kapƒ±sƒ±" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">IP Adresi *</label>
                        <input type="text" class="form-control" @bind="newDevice.IpAddress" placeholder="192.168.1.100" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Port</label>
                        <input type="text" class="form-control" @bind="newDevice.Port" placeholder="4370" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Cihaz Kodu</label>
                        <input type="text" class="form-control" @bind="newDevice.DeviceCode" placeholder="DEV001" />
                    </div>
                    <div class="col-md-1">
                        <label class="form-label">Aktif</label>
                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" @bind="newDevice.IsActive" />
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <button class="btn btn-success" @onclick="SaveDevice">
                            <i class="bx bx-save"></i> Kaydet
                        </button>
                        <button class="btn btn-secondary ms-2" @onclick="ToggleAddForm">ƒ∞ptal</button>
                    </div>
                </div>
            </div>
        </div>
    }

    @if (devices == null)
    {
        <p><em>Y√ºkleniyor...</em></p>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-hover table-sm">
                <thead>
                    <tr>
                        <th>Cihaz Adƒ±</th>
                        <th>IP:Port</th>
                        <th>Durum</th>
                        <th>Son Kontrol</th>
                        <th style="min-width: 400px;">ƒ∞≈ülemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var device in devices)
                    {
                        <tr>
                            <td><strong>@device.DeviceName</strong></td>
                            <td><code>@device.IpAddress:@device.Port</code></td>
                            <td>
                                <span class="badge @(device.IsActive ? "bg-success" : "bg-secondary")">
                                    @(device.IsActive ? "Aktif" : "Pasif")
                                </span>
                            </td>
                            <td><small>@device.LastHealthCheckTime?.ToString("dd.MM HH:mm")</small></td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-info" @onclick="() => TestConnection(device.Id)" title="Baƒülantƒ± Testi">
                                        <i class="bx bx-wifi"></i>
                                    </button>
                                    <button class="btn btn-outline-warning" @onclick="() => GetStatus(device.Id)" title="Durum">
                                        <i class="bx bx-info-circle"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" @onclick="() => GetDeviceTime(device.Id)" title="Cihaz Saati">
                                        <i class="bx bx-time"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" @onclick="() => SyncDeviceTime(device.Id)" title="Saati Senkronize Et">
                                        <i class="bx bx-sync"></i>
                                    </button>
                                    <button class="btn btn-outline-success" @onclick="() => ShowDeviceUsers(device.Id)" title="Cihazdaki Personeller">
                                        <i class="bx bx-group"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" @onclick="() => OpenSendPersonelModal(device.Id)" title="Personel G√∂nder">
                                        <i class="bx bx-user-plus"></i>
                                    </button>
                                    <button class="btn btn-outline-dark" @onclick="() => RestartDevice(device.Id)" title="Yeniden Ba≈ülat">
                                        <i class="bx bx-revision"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" @onclick="() => Delete(device.Id)" title="Sil">
                                        <i class="bx bx-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SEND PERSONEL MODAL -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
@if (showSendPersonelModal)
{
    <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white">
                        <i class="bx bx-user-plus me-2"></i>Personel G√∂nder - @selectedDeviceName
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseSendPersonelModal"></button>
                </div>
                <div class="modal-body">
                    @if (isLoadingPersonel)
                    {
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Y√ºkleniyor...</span>
                            </div>
                            <p class="mt-2 text-muted">Personeller y√ºkleniyor...</p>
                        </div>
                    }
                    else
                    {
                        <!-- Arama ve Toplu Se√ßim -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bx bx-search"></i>
                                    </span>
                                    <input type="text"
                                           class="form-control"
                                           placeholder="Ad, Sicil veya TC ile ara..."
                                           @bind="personelSearchTerm"
                                           @bind:event="oninput"
                                           @onkeyup="FilterPersonel" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-primary w-100" @onclick="ToggleSelectAllPersonel">
                                    <i class="bx @(IsAllPersonelSelected() ? "bx-checkbox-checked" : "bx-checkbox") me-1"></i>
                                    @(IsAllPersonelSelected() ? "T√ºm√ºn√ºn Se√ßimini Kaldƒ±r" : "T√ºm√ºn√º Se√ß")
                                </button>
                            </div>
                        </div>

                        <!-- Se√ßim Bilgisi -->
                        @if (selectedPersonelIds.Any())
                        {
                            <div class="alert alert-info mb-3">
                                <i class="bx bx-info-circle me-2"></i>
                                <strong>@selectedPersonelIds.Count</strong> personel se√ßildi
                            </div>
                        }

                        <!-- Personel Listesi -->
                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-hover">
                                <thead style="position: sticky; top: 0; background: white; z-index: 10;">
                                    <tr>
                                        <th style="width: 40px;">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   checked="@IsAllPersonelSelected()"
                                                   @onchange="ToggleSelectAllPersonel" />
                                        </th>
                                        <th>Sicil No</th>
                                        <th>TC Kimlik No</th>
                                        <th>Ad Soyad</th>
                                        <th>Departman</th>
                                        <th>PDKS Kayƒ±t No</th>
                                        <th>Kart No</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!filteredPersonelList.Any())
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                <i class="bx bx-search-alt bx-lg"></i>
                                                <p class="mb-0 mt-2">Personel bulunamadƒ±</p>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        @foreach (var personel in filteredPersonelList)
                                        {
                                            var isSelected = selectedPersonelIds.Contains(personel.TcKimlikNo);
                                            <tr class="@(isSelected ? "table-active" : "")"
                                                style="cursor: pointer;"
                                                @onclick="() => TogglePersonelSelection(personel.TcKimlikNo)">
                                                <td>
                                                    <input type="checkbox"
                                                           class="form-check-input"
                                                           checked="@isSelected"
                                                           @onclick:stopPropagation="true"
                                                           @onchange="() => TogglePersonelSelection(personel.TcKimlikNo)" />
                                                </td>
                                                <td><span class="badge bg-label-secondary">@personel.SicilNo</span></td>
                                                <td><small>@personel.TcKimlikNo</small></td>
                                                <td><strong>@personel.AdSoyad</strong></td>
                                                <td><small class="text-muted">@personel.DepartmanAdi</small></td>
                                                <td><span class="badge bg-label-info">@personel.PersonelKayitNo</span></td>
                                                <td>
                                                    @if (personel.KartNo > 0)
                                                    {
                                                        <span class="badge bg-label-primary">@personel.KartNo</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">-</span>
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" @onclick="CloseSendPersonelModal" disabled="@isSendingPersonel">
                        ƒ∞ptal
                    </button>
                    <button type="button"
                            class="btn btn-primary"
                            @onclick="SendSelectedPersonelToDevice"
                            disabled="@(!selectedPersonelIds.Any() || isSendingPersonel)">
                        @if (isSendingPersonel)
                        {
                            <span class="spinner-border spinner-border-sm me-1"></span>
                        }
                        <i class="bx bx-send me-1"></i>Se√ßili Personelleri G√∂nder (@selectedPersonelIds.Count)
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private List<Device>? devices;
    private string apiBaseUrl = "";
    private bool showAddForm = false;
    private Device newDevice = new Device { Port = "4370", IsActive = true };

    // Personel G√∂nderme Modal
    private bool showSendPersonelModal = false;
    private int selectedDeviceId = 0;
    private string selectedDeviceName = "";
    private bool isLoadingPersonel = false;
    private bool isSendingPersonel = false;
    private List<PersonelDto> personelList = new List<PersonelDto>();
    private List<PersonelDto> filteredPersonelList = new List<PersonelDto>();
    private List<string> selectedPersonelIds = new List<string>();
    private string personelSearchTerm = "";

    protected override async Task OnInitializedAsync()
    {
        apiBaseUrl = Configuration["AppSettings:Urls:HttpsUrl"] ?? "https://localhost:9080";
        await LoadDevices();
    }

    private async Task LoadDevices()
    {
        devices = await Http.GetFromJsonAsync<List<Device>>($"{apiBaseUrl}/api/Device");
    }

    private void ToggleAddForm()
    {
        showAddForm = !showAddForm;
        if (showAddForm)
        {
            newDevice = new Device { Port = "4370", IsActive = true };
        }
    }

    private async Task SaveDevice()
    {
        if (string.IsNullOrWhiteSpace(newDevice.DeviceName) || string.IsNullOrWhiteSpace(newDevice.IpAddress))
        {
            await JS.InvokeVoidAsync("alert", "Cihaz adƒ± ve IP adresi zorunludur!");
            return;
        }

        try
        {
            var response = await Http.PostAsJsonAsync($"{apiBaseUrl}/api/Device", newDevice);
            if (response.IsSuccessStatusCode)
            {
                await JS.InvokeVoidAsync("alert", "‚úÖ Cihaz ba≈üarƒ±yla eklendi!");
                showAddForm = false;
                await LoadDevices();
            }
            else
            {
                await JS.InvokeVoidAsync("alert", "‚ùå Cihaz eklenemedi!");
            }
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"‚ùå Hata: {ex.Message}");
        }
    }

    private async Task TestConnection(int deviceId)
    {
        var response = await Http.PostAsync($"{apiBaseUrl}/api/Device/{deviceId}/test", null);
        var result = await response.Content.ReadFromJsonAsync<dynamic>();
        await JS.InvokeVoidAsync("alert", result?.Success == true ? "‚úÖ Baƒülantƒ± ba≈üarƒ±lƒ±!" : "‚ùå Baƒülantƒ± ba≈üarƒ±sƒ±z!");
        await LoadDevices();
    }

    private async Task GetStatus(int deviceId)
    {
        try
        {
            var status = await Http.GetFromJsonAsync<dynamic>($"{apiBaseUrl}/api/Device/{deviceId}/status");
            var message = $"üìä Cihaz Durum Bilgisi:\n\n" +
                         $"Firmware: {status?.FirmwareVersion}\n" +
                         $"Seri No: {status?.SerialNumber}\n" +
                         $"Platform: {status?.Platform}\n" +
                         $"Kullanƒ±cƒ±: {status?.UserCount} / {status?.UserCapacity}\n" +
                         $"Kayƒ±t: {status?.AttendanceLogCount} / {status?.AttLogCapacity}\n" +
                         $"Parmak ƒ∞zi: {status?.FingerPrintCount} / {status?.FingerPrintCapacity}";
            await JS.InvokeVoidAsync("alert", message);
        }
        catch
        {
            await JS.InvokeVoidAsync("alert", "‚ùå Cihaz durumu alƒ±namadƒ±!");
        }
    }

    private async Task GetDeviceTime(int deviceId)
    {
        try
        {
            var timeDto = await Http.GetFromJsonAsync<dynamic>($"{apiBaseUrl}/api/Device/{deviceId}/time");
            var deviceTime = DateTime.Parse(timeDto?.DeviceTime.ToString());
            var diff = timeDto?.TimeDifferenceSeconds;
            await JS.InvokeVoidAsync("alert", $"üïê Cihaz Saati:\n{deviceTime:dd.MM.yyyy HH:mm:ss}\n\nSunucu ile fark: {diff} saniye");
        }
        catch
        {
            await JS.InvokeVoidAsync("alert", "‚ùå Cihaz saati alƒ±namadƒ±!");
        }
    }

    private async Task SyncDeviceTime(int deviceId)
    {
        if (await JS.InvokeAsync<bool>("confirm", "Cihaz saatini ≈üu anki sunucu saatiyle senkronize etmek istediƒüinize emin misiniz?"))
        {
            try
            {
                await Http.PostAsync($"{apiBaseUrl}/api/Device/{deviceId}/time/sync", null);
                await JS.InvokeVoidAsync("alert", "‚úÖ Cihaz saati senkronize edildi!");
            }
            catch
            {
                await JS.InvokeVoidAsync("alert", "‚ùå Cihaz saati senkronize edilemedi!");
            }
        }
    }

    private async Task ShowDeviceUsers(int deviceId)
    {
        try
        {
            var users = await Http.GetFromJsonAsync<List<dynamic>>($"{apiBaseUrl}/api/ZKTecoUser/device/{deviceId}/from-device");
            if (users != null && users.Any())
            {
                await JS.InvokeVoidAsync("alert", $"üë• Cihazdaki Personel Sayƒ±sƒ±: {users.Count}\n\nDetaylƒ± liste i√ßin 'Kullanƒ±cƒ± Y√∂netimi' sayfasƒ±nƒ± ziyaret edin.");
            }
            else
            {
                await JS.InvokeVoidAsync("alert", "‚ÑπÔ∏è Cihazda kayƒ±tlƒ± personel bulunamadƒ±.");
            }
        }
        catch
        {
            await JS.InvokeVoidAsync("alert", "‚ùå Personel listesi alƒ±namadƒ±!");
        }
    }

    private async Task RestartDevice(int deviceId)
    {
        if (await JS.InvokeAsync<bool>("confirm", "‚ö†Ô∏è Cihazƒ± yeniden ba≈ülatmak istediƒüinize emin misiniz?\n\nCihaz yakla≈üƒ±k 30 saniye offline olacak."))
        {
            try
            {
                await Http.PostAsync($"{apiBaseUrl}/api/Device/{deviceId}/restart", null);
                await JS.InvokeVoidAsync("alert", "‚úÖ Cihaz yeniden ba≈ülatƒ±lƒ±yor...");
            }
            catch
            {
                await JS.InvokeVoidAsync("alert", "‚ùå Cihaz yeniden ba≈ülatƒ±lamadƒ±!");
            }
        }
    }

    private async Task Delete(int deviceId)
    {
        if (await JS.InvokeAsync<bool>("confirm", "‚ö†Ô∏è Cihazƒ± silmek istediƒüinize emin misiniz?\n\nBu i≈ülem geri alƒ±namaz!"))
        {
            try
            {
                await Http.DeleteAsync($"{apiBaseUrl}/api/Device/{deviceId}");
                await JS.InvokeVoidAsync("alert", "‚úÖ Cihaz silindi!");
                await LoadDevices();
            }
            catch
            {
                await JS.InvokeVoidAsync("alert", "‚ùå Cihaz silinemedi!");
            }
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PERSONEL G√ñNDERME MODALƒ∞
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    private async Task OpenSendPersonelModal(int deviceId)
    {
        var device = devices?.FirstOrDefault(d => d.Id == deviceId);
        if (device == null) return;

        selectedDeviceId = deviceId;
        selectedDeviceName = device.DeviceName ?? "";
        showSendPersonelModal = true;
        isLoadingPersonel = true;

        try
        {
            // Personelleri y√ºkle
            var result = await Http.GetFromJsonAsync<List<PersonelDto>>($"{apiBaseUrl}/api/Personel");
            personelList = result ?? new List<PersonelDto>();
            filteredPersonelList = personelList;
        }
        catch
        {
            await JS.InvokeVoidAsync("alert", "‚ùå Personeller y√ºklenemedi!");
            personelList = new List<PersonelDto>();
            filteredPersonelList = new List<PersonelDto>();
        }
        finally
        {
            isLoadingPersonel = false;
            StateHasChanged();
        }
    }

    private void CloseSendPersonelModal()
    {
        showSendPersonelModal = false;
        selectedDeviceId = 0;
        selectedDeviceName = "";
        personelList.Clear();
        filteredPersonelList.Clear();
        selectedPersonelIds.Clear();
        personelSearchTerm = "";
    }

    private void FilterPersonel()
    {
        if (string.IsNullOrWhiteSpace(personelSearchTerm))
        {
            filteredPersonelList = personelList;
        }
        else
        {
            var searchLower = personelSearchTerm.ToLower();
            filteredPersonelList = personelList
                .Where(p =>
                    p.AdSoyad.ToLower().Contains(searchLower) ||
                    p.TcKimlikNo.Contains(searchLower) ||
                    p.SicilNo.ToString().Contains(searchLower))
                .ToList();
        }

        StateHasChanged();
    }

    private void TogglePersonelSelection(string tcKimlikNo)
    {
        if (selectedPersonelIds.Contains(tcKimlikNo))
        {
            selectedPersonelIds.Remove(tcKimlikNo);
        }
        else
        {
            selectedPersonelIds.Add(tcKimlikNo);
        }

        StateHasChanged();
    }

    private void ToggleSelectAllPersonel()
    {
        if (IsAllPersonelSelected())
        {
            selectedPersonelIds.Clear();
        }
        else
        {
            selectedPersonelIds = filteredPersonelList.Select(p => p.TcKimlikNo).ToList();
        }

        StateHasChanged();
    }

    private bool IsAllPersonelSelected()
    {
        return filteredPersonelList.Any() &&
               filteredPersonelList.All(p => selectedPersonelIds.Contains(p.TcKimlikNo));
    }

    private async Task SendSelectedPersonelToDevice()
    {
        if (!selectedPersonelIds.Any())
        {
            await JS.InvokeVoidAsync("alert", "‚ö†Ô∏è L√ºtfen en az bir personel se√ßin!");
            return;
        }

        if (!await JS.InvokeAsync<bool>("confirm", $"Se√ßili {selectedPersonelIds.Count} personeli {selectedDeviceName} cihazƒ±na g√∂ndermek istediƒüinize emin misiniz?"))
        {
            return;
        }

        isSendingPersonel = true;

        try
        {
            // TODO: Toplu personel g√∂nderme API endpoint'i kullanƒ±lacak
            // ≈ûimdilik tek tek g√∂nderelim
            int successCount = 0;
            int failCount = 0;

            foreach (var tcKimlikNo in selectedPersonelIds)
            {
                try
                {
                    var personel = personelList.FirstOrDefault(p => p.TcKimlikNo == tcKimlikNo);
                    if (personel != null)
                    {
                        // POST /api/ZKTecoUser/{userId}/sync-to-device/{deviceId} endpoint'ini kullan
                        var response = await Http.PostAsync(
                            $"{apiBaseUrl}/api/ZKTecoUser/{personel.PersonelKayitNo}/sync-to-device/{selectedDeviceId}",
                            null);

                        if (response.IsSuccessStatusCode)
                        {
                            successCount++;
                        }
                        else
                        {
                            failCount++;
                        }
                    }
                }
                catch
                {
                    failCount++;
                }
            }

            var message = $"‚úÖ ƒ∞≈ülem tamamlandƒ±!\n\n" +
                         $"Ba≈üarƒ±lƒ±: {successCount}\n" +
                         $"Ba≈üarƒ±sƒ±z: {failCount}";

            await JS.InvokeVoidAsync("alert", message);

            if (successCount > 0)
            {
                CloseSendPersonelModal();
            }
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"‚ùå Hata: {ex.Message}");
        }
        finally
        {
            isSendingPersonel = false;
            StateHasChanged();
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // HELPER CLASS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    public class PersonelDto
    {
        public string TcKimlikNo { get; set; } = "";
        public int SicilNo { get; set; }
        public string AdSoyad { get; set; } = "";
        public string DepartmanAdi { get; set; } = "";
        public int PersonelKayitNo { get; set; }
        public int KartNo { get; set; }
    }
}
