@page "/pdks/izin/detay/{id:int}"
@using SGKPortalApp.BusinessObjectLayer.DTOs.Response.PdksIslemleri
@using SGKPortalApp.PresentationLayer.Components.Permission
@inherits SGKPortalApp.PresentationLayer.Components.Base.FieldPermissionPageBase

<PageTitle>Ä°zin/Mazeret Talep DetayÄ±</PageTitle>

@if (!CanViewPage)
{
    <div class="alert alert-danger" role="alert">
        <i class="bx bx-lock-alt me-2"></i>
        Bu sayfayÄ± gÃ¶rÃ¼ntÃ¼leme yetkiniz bulunmuyor.
    </div>
}
else
{
    <FieldPermissionScope PageKey="@ResolvedPermissionKey" IsEditMode="false">
        <div class="container-fluid">
            <!-- Header -->
            <div class="row mb-3">
                <div class="col">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/pdks/izin/taleplerim">Taleplerim</a></li>
                            <li class="breadcrumb-item active">Talep DetayÄ±</li>
                        </ol>
                    </nav>
                    <h3>ðŸ“‹ Ä°zin/Mazeret Talep DetayÄ±</h3>
                </div>
                <div class="col-auto">
                    <div class="btn-group">
                        @if (Talep != null && CanEdit(Talep))
                        {
                            <button class="btn btn-outline-warning" @onclick="EditTalep" title="DÃ¼zenle">
                                <i class="bx bx-edit me-1"></i>DÃ¼zenle
                            </button>
                            <button class="btn btn-outline-info" @onclick="CancelTalep" title="Ä°ptal Et">
                                <i class="bx bx-x me-1"></i>Ä°ptal Et
                            </button>
                            <button class="btn btn-outline-danger" @onclick="DeleteTalep" title="Sil">
                                <i class="bx bx-trash me-1"></i>Sil
                            </button>
                        }
                        <button class="btn btn-secondary" @onclick="GoBack">
                            <i class="bx bx-arrow-back me-1"></i>Geri DÃ¶n
                        </button>
                    </div>
                </div>
            </div>

            @if (IsLoading)
            {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">YÃ¼kleniyor...</span>
                    </div>
                    <p class="mt-2">Talep detaylarÄ± yÃ¼kleniyor...</p>
                </div>
            }
            else if (Talep == null)
            {
                <div class="alert alert-warning">
                    <i class="bx bx-info-circle me-2"></i>
                    Talep bulunamadÄ±.
                </div>
            }
            else
            {
                <div class="row">
                    <!-- Talep Bilgileri -->
                    <div class="col-md-8">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Talep Bilgileri</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Talep No:</label>
                                        <p class="form-control-plaintext">#@Talep.IzinMazeretTalepId</p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Talep TÃ¼rÃ¼:</label>
                                        <p class="form-control-plaintext">
                                            <span class="badge bg-label-info">@Talep.TuruAdi</span>
                                        </p>
                                    </div>
                                </div>

                                @if (Talep.BaslangicTarihi.HasValue && Talep.BitisTarihi.HasValue)
                                {
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">BaÅŸlangÄ±Ã§ Tarihi:</label>
                                            <p class="form-control-plaintext">@Talep.BaslangicTarihi.Value.ToString("dd.MM.yyyy")</p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">BitiÅŸ Tarihi:</label>
                                            <p class="form-control-plaintext">@Talep.BitisTarihi.Value.ToString("dd.MM.yyyy")</p>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Toplam GÃ¼n:</label>
                                            <p class="form-control-plaintext">@(Talep.ToplamGun ?? 0) gÃ¼n</p>
                                        </div>
                                    </div>
                                }
                                else if (Talep.MazeretTarihi.HasValue)
                                {
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">Mazeret Tarihi:</label>
                                            <p class="form-control-plaintext">@Talep.MazeretTarihi.Value.ToString("dd.MM.yyyy")</p>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">BaÅŸlangÄ±Ã§ Saati:</label>
                                            <p class="form-control-plaintext">@(Talep.BaslangicSaati?.ToString(@"hh\:mm") ?? "-")</p>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label fw-bold">BitiÅŸ Saati:</label>
                                            <p class="form-control-plaintext">@(Talep.BitisSaati?.ToString(@"hh\:mm") ?? "-")</p>
                                        </div>
                                    </div>
                                }

                                <div class="row mb-3">
                                    <div class="col-12">
                                        <label class="form-label fw-bold">AÃ§Ä±klama:</label>
                                        <p class="form-control-plaintext">@(string.IsNullOrEmpty(Talep.Aciklama) ? "-" : Talep.Aciklama)</p>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Talep Tarihi:</label>
                                        <p class="form-control-plaintext">@Talep.TalepTarihi.ToString("dd.MM.yyyy HH:mm")</p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Genel Durum:</label>
                                        <p class="form-control-plaintext">
                                            <span class="badge @GetDurumBadgeClass(GetGenelDurum())">@GetGenelDurum()</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onay Bilgileri -->
                    <div class="col-md-4">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Onay SÃ¼reci</h5>
                            </div>
                            <div class="card-body">
                                <!-- Birinci Onay -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">1. Onay:</label>
                                    <p class="form-control-plaintext">
                                        <span class="badge @GetOnayBadgeClass(Talep.BirinciOnayDurumuAdi)">
                                            @Talep.BirinciOnayDurumuAdi
                                        </span>
                                    </p>
                                    @if (!string.IsNullOrEmpty(Talep.BirinciOnayciAdSoyad))
                                    {
                                        <small class="text-muted">@Talep.BirinciOnayciAdSoyad</small>
                                    }
                                </div>

                                <!-- Ä°kinci Onay -->
                                @if (!string.IsNullOrEmpty(Talep.IkinciOnayDurumuAdi))
                                {
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">2. Onay:</label>
                                        <p class="form-control-plaintext">
                                            <span class="badge @GetOnayBadgeClass(Talep.IkinciOnayDurumuAdi)">
                                                @Talep.IkinciOnayDurumuAdi
                                            </span>
                                        </p>
                                        @if (!string.IsNullOrEmpty(Talep.IkinciOnayciAdSoyad))
                                        {
                                            <small class="text-muted">@Talep.IkinciOnayciAdSoyad</small>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </FieldPermissionScope>
}
