@inherits LayoutComponentBase
@using SGKPortalApp.PresentationLayer.Components.Siramatik

<div class="layout-wrapper layout-content-navbar @(siraPanelAcik ? "sira-panel-open" : "") @(IsInBankoMode ? "banko-mode-active" : "")">
    <div class="layout-container">
        <NavMenu />
        <div class="layout-page">
            <TopBar />
            <div class="content-wrapper">
                <div class="container-xxl flex-grow-1 container-p-y">
                    @if (!PermissionContextReady)
                    {
                        <div class="d-flex align-items-center justify-content-center" style="min-height: 40vh;">
                            <div class="text-center">
                                <div class="spinner-border text-primary mb-3" role="status">
                                    <span class="visually-hidden">Yükleniyor...</span>
                                </div>
                                <p class="text-muted mb-0">Yetki bilgileri yükleniyor, lütfen bekleyin…</p>
                            </div>
                        </div>
                    }
                    else
                    {
                        @Body
                    }
                </div>

                <Toast />

                <Footer />
                <div class="content-backdrop fade"></div>
            </div>
        </div>
    </div>
    <div class="layout-overlay layout-menu-toggle"></div>
</div>

@* Sıra Çağırma Paneli - Sadece Banko Modunda Görünür *@
@if (IsInBankoMode)
{
    <SiraCagirmaPanel 
        SiraListesi="@siraListesi" 
        OnSiraCagir="@HandleSiraCagir" 
        OnPanelStateChanged="@HandlePanelStateChanged"
        AktifBankoId="@(BankoModeState.GetUserActiveBankoId(_tcKimlikNo ?? "") ?? 0)"
        PersonelTcKimlikNo="@(_tcKimlikNo ?? string.Empty)" />
}

@* SignalR Bağlantısı - _Host.cshtml'de merkezi olarak yönetilir *@
