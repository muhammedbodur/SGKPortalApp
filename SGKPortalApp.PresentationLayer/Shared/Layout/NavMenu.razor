@inject NavigationManager Navigation
@inject SGKPortalApp.PresentationLayer.Services.State.BankoModeStateService BankoModeState
@inject IHttpContextAccessor HttpContextAccessor

@code {
    private string? _tcKimlikNo;
    private bool IsInBankoMode => !string.IsNullOrEmpty(_tcKimlikNo) && BankoModeState.IsPersonelInBankoMode(_tcKimlikNo);
}

<!-- Layout menu -->
<aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">

    <div class="app-brand demo">
        <a href="/" class="app-brand-link">
            <span class="app-brand-logo demo">
                <img src="/Logo/sgk-logo.svg" alt="SGK Logo" width="70" height="35" />
            </span>
            <span class="app-brand-text menu-text fw-bolder ms-2">İzmir Sgk Portal</span>
        </a>
        <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
            <i class="bx bx-chevron-left bx-sm align-middle"></i>
        </a>
    </div>

    <div class="menu-inner-shadow"></div>

    <!-- Menu Inner -->
    <ul class="menu-inner py-1">

        <!-- ================ ANA SAYFA ================ -->
        <li class="menu-item @(IsActive("/") ? "active" : "")">
            <a href="/" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div>Ana Sayfa</div>
            </a>
        </li>

        @if (!IsInBankoMode)
        {
            <!-- Hizmet Binaları -->
            <li class="menu-item @(IsSectionActive("/common") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-cog"></i>
                    <div>Ortak Tanımlar</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsActive("/common/hizmetbinasi") && !Navigation.Uri.Contains("/manage") && !Navigation.Uri.Contains("/detail") ? "active" : "")">
                        <a href="/common/hizmetbinasi" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-building"></i>
                            <div>Hizmet Binaları</div>
                        </a>
                    </li>
                </ul>
                <ul class="menu-sub">
                    <li class="menu-item @(IsSectionActive("/common/il") ? "active" : "")">
                        <a href="/common/il" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-map"></i>
                            <div>İller</div>
                        </a>
                    </li>
                </ul>
                <ul class="menu-sub">
                    <li class="menu-item @(IsSectionActive("/common/ilce") ? "active" : "")">
                        <a href="/common/ilce" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-map-pin"></i>
                            <div>İlçeler</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ PERSONEL İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Personel İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/personel") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-user"></i>
                    <div>Personel</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsActive("/personel") && !Navigation.Uri.Contains("/departman") && !Navigation.Uri.Contains("/servis") && !Navigation.Uri.Contains("/unvan") ? "active" : "")">
                        <a href="/personel" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-user"></i>
                            <div>Personel Listesi</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/personel/manage") ? "active" : "")">
                        <a href="/personel/manage" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-user-plus"></i>
                            <div>Yeni Personel</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/personel/departman") ? "active" : "")">
                        <a href="/personel/departman" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-git-branch"></i>
                            <div>Departmanlar</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/personel/servis") ? "active" : "")">
                        <a href="/personel/servis" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-group"></i>
                            <div>Servisler</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/personel/unvan") ? "active" : "")">
                        <a href="/personel/unvan" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-id-card"></i>
                            <div>Unvanlar</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/personel/sendika") ? "active" : "")">
                        <a href="/personel/sendika" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-unite"></i>
                            <div>Sendikalar</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/personel/atanma-nedeni") ? "active" : "")">
                        <a href="/personel/atanma-nedeni" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-file"></i>
                            <div>Atanma Nedenleri</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ LOG İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Log İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/audit") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-file-find"></i>
                    <div>Log Yönetimi</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsActive("/audit/log") ? "active" : "")">
                        <a href="/audit/log" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-detail"></i>
                            <div>Denetim Logları</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/audit/login-logout") ? "active" : "")">
                        <a href="/audit/login-logout" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-log-in"></i>
                            <div>Giriş/Çıkış Logları</div>
                        </a>
                    </li>
                    <!-- Gelecekte eklenebilir:
                    <li class="menu-item">
                        <a href="/audit/signalr" class="menu-link">
                            <div>SignalR Logları</div>
                        </a>
                    </li>
                    -->
                </ul>
            </li>

            <!-- ================ YETKİ İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Yetki İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/yetki-") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-shield-quarter"></i>
                    <div>Yetki Yönetimi</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsSectionActive("/yetki-atama") ? "active" : "")">
                        <a href="/yetki-atama" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-user-check"></i>
                            <div>Yetki Atama</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/yetki-modul") ? "active" : "")">
                        <a href="/yetki-modul" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-folder"></i>
                            <div>Modüller</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/yetki-controller") ? "active" : "")">
                        <a href="/yetki-controller" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-folder-open"></i>
                            <div>Controller'lar</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/yetki-islem") ? "active" : "")">
                        <a href="/yetki-islem" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-list-ul"></i>
                            <div>İşlemler</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ SIRAMATİK İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Sıramatik İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/siramatik") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-desktop"></i>
                    <div>Sıramatik</div>
                </a>
                <ul class="menu-sub">
                    <!-- Bankolar -->
                    <li class="menu-item @(IsSectionActive("/siramatik/banko") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <div>Bankolar</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/siramatik/banko") ? "active" : "")">
                                <a href="/siramatik/banko" class="menu-link">
                                    <div>Banko Listesi</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/banko/manage") ? "active" : "")">
                                <a href="/siramatik/banko/manage" class="menu-link">
                                    <div>Yeni Banko Ekle</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/banko/personel-atama") ? "active" : "")">
                                <a href="/siramatik/banko/personel-atama" class="menu-link">
                                    <div>Personel Atama</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- Ana Kanal -->
                    <li class="menu-item @(IsSectionActive("/siramatik/kanal") || IsSectionActive("/siramatik/alt-kanal") || IsSectionActive("/siramatik/kanal-altkanal-eslestirme") || IsSectionActive("/siramatik/personel-atama") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <div>Kanal Yönetimi</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/siramatik/kanal") && !Navigation.Uri.Contains("/manage") ? "active" : "")">
                                <a href="/siramatik/kanal" class="menu-link">
                                    <div>Kanallar</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/kanal/manage") ? "active" : "")">
                                <a href="/siramatik/kanal/manage" class="menu-link">
                                    <div>Yeni Kanal</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/alt-kanal") && !Navigation.Uri.Contains("/manage") ? "active" : "")">
                                <a href="/siramatik/alt-kanal" class="menu-link">
                                    <div>Alt Kanallar</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/alt-kanal/manage") ? "active" : "")">
                                <a href="/siramatik/alt-kanal/manage" class="menu-link">
                                    <div>Yeni Alt Kanal</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/kanal-islem") && !Navigation.Uri.Contains("/manage") ? "active" : "")">
                                <a href="/siramatik/kanal-islem" class="menu-link">
                                    <div>Kanal İşlemleri</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/kanal/manage") ? "active" : "")">
                                <a href="/siramatik/kanal/manage" class="menu-link">
                                    <div>Yeni Kanal İşlem</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/kanal-alt-islem") && !Navigation.Uri.Contains("/manage") ? "active" : "")">
                                <a href="/siramatik/kanal-alt-islem" class="menu-link">
                                    <div>Alt Kanal İşlemleri</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/kanal-alt-islem/manage") ? "active" : "")">
                                <a href="/siramatik/kanal-alt-islem/manage" class="menu-link">
                                    <div>Yeni Alt İşlem</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/personel-atama") ? "active" : "")">
                                <a href="/siramatik/personel-atama" class="menu-link">
                                    <div>Personel Atama</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- Kiosk Yönetimi -->
                    <li class="menu-item @(IsSectionActive("/siramatik/kiosk") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <div>Kiosk Yönetimi</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/siramatik/kiosk-menu") ? "active" : "")">
                                <a href="/siramatik/kiosk-menu" class="menu-link">
                                    <div>Kiosk Menüleri</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/kiosk-yonetimi") || IsActive("/siramatik/kiosk/list") ? "active" : "")">
                                <a href="/siramatik/kiosk-yonetimi" class="menu-link">
                                    <div>Kiosk Cihazları</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/kiosk-menu-atama") ? "active" : "")">
                                <a href="/siramatik/kiosk-menu-atama" class="menu-link">
                                    <div>Kiosk Menü Ataması</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/kiosk-menu-eslestirme") ? "active" : "")">
                                <a href="/siramatik/kiosk-menu-eslestirme" class="menu-link">
                                    <div>Kiosk Menü Eşleştirme</div>
                                </a>
                            </li>
                            @* <li class="menu-item @(IsActive("/siramatik/kiosk-menu-islem") ? "active" : "")">
                                <a href="/siramatik/kiosk-menu-islem" class="menu-link">
                                    <div>Menü Alt Kanal İşlemleri</div>
                                </a>
                            </li> *@
                            <li class="menu-item @(IsActive("/siramatik/menu-islem-eslestirme") ? "active" : "")">
                                <a href="/siramatik/menu-islem-eslestirme" class="menu-link">
                                    <div>Kiosk Menü Alt Kanal Eşleştirme</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/kiosk-simulator") ? "active" : "")">
                                <a href="/siramatik/kiosk-simulator" class="menu-link">
                                    <i class="bx bx-terminal me-2 text-warning"></i>
                                    <div>Kiosk Simülatör</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- TV'ler -->
                    <li class="menu-item @(IsSectionActive("/siramatik/tv") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <div>TV'ler</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/siramatik/tv") ? "active" : "")">
                                <a href="/siramatik/tv" class="menu-link">
                                    <div>TV Listesi</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/tv/manage") ? "active" : "")">
                                <a href="/siramatik/tv/manage" class="menu-link">
                                    <div>Yeni TV Ekle</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/siramatik/tv/banko-eslestirme") ? "active" : "")">
                                <a href="/siramatik/tv/banko-eslestirme" class="menu-link">
                                    <div>Banko Eşleştirme</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- SignalR Logs (Monitoring) -->
                    <li class="menu-item @(IsActive("/siramatik/signalr-logs") ? "active" : "")">
                        <a href="/siramatik/signalr-logs" class="menu-link">
                            <div>SignalR Logs</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ PDKS İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">PDKS İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/pdks") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-time-five"></i>
                    <div>PDKS</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsSectionActive("/pdks/giris-cikis") ? "active" : "")">
                        <a href="/pdks/giris-cikis" class="menu-link">
                            <div>Giriş/Çıkış</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/giris-cikis/realtime") ? "active" : "")">
                        <a href="/pdks/giris-cikis/realtime" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-broadcast"></i>
                            <div>Realtime İzleme</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/zkteco/devices") ? "active" : "")">
                        <a href="/pdks/zkteco/devices" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-devices"></i>
                            <div>Cihaz Yönetimi</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/zkteco/instant-attendance") ? "active" : "")">
                        <a href="/pdks/zkteco/instant-attendance" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-list-check"></i>
                            <div>Anlık Attendance Kayıtları</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/zkteco/device-sync") ? "active" : "")">
                        <a href="/pdks/zkteco/device-sync" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-sync"></i>
                            <div>Cihaz Senkronizasyonu</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/special-cards") ? "active" : "")">
                        <a href="/pdks/special-cards" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-credit-card"></i>
                            <div>Özel Kartlar</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/pdks/card-sync-comparison") ? "active" : "")">
                        <a href="/pdks/card-sync-comparison" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-arrow-from-left"></i>
                            <div>Kart Senkronizasyon Karşılaştırma</div>
                        </a>
                    </li>

                    <li class="menu-item @(IsSectionActive("/pdks/izin") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-calendar-check"></i>
                            <div>İzin/Mazeret Yönetimi</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/pdks/izin/taleplerim") ? "active" : "")">
                                <a href="/pdks/izin/taleplerim" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-list-ul"></i>
                                    <div>Taleplerim</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/pdks/izin/yeni-talep") ? "active" : "")">
                                <a href="/pdks/izin/yeni-talep" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-plus-circle"></i>
                                    <div>Yeni Talep</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/pdks/izin/onay-bekleyenler") ? "active" : "")">
                                <a href="/pdks/izin/onay-bekleyenler" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-check-circle"></i>
                                    <div>Onay Bekleyenler</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/pdks/izin/sorumlu-atama") ? "active" : "")">
                                <a href="/pdks/izin/sorumlu-atama" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-user-check"></i>
                                    <div>Sorumlu Atama</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item @(IsSectionActive("/pdks/mesai") ? "active open" : "")">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-time-five"></i>
                            <div>Mesai Yönetimi</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item @(IsActive("/pdks/mesai/listele") ? "active" : "")">
                                <a href="/pdks/mesai/listele" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-list-ul"></i>
                                    <div>Mesai Listeleme</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/pdks/mesai/personel-listesi") ? "active" : "")">
                                <a href="/pdks/mesai/personel-listesi" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-user-check"></i>
                                    <div>Personel Listesi</div>
                                </a>
                            </li>
                            <li class="menu-item @(IsActive("/pdks/mesai/departman-rapor") ? "active" : "")">
                                <a href="/pdks/mesai/departman-rapor" class="menu-link">
                                    <i class="menu-icon tf-icons bx bx-bar-chart"></i>
                                    <div>Departman Mesai Raporu</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item @(IsSectionActive("/pdks/raporlar") ? "active" : "")">
                        <a href="/pdks/raporlar/personel-mesai" class="menu-link">
                            <div>Raporlar</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ ESHOT İŞLEMLERİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Eshot İşlemleri</span>
            </li>

            <li class="menu-item @(IsSectionActive("/eshot") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-bus"></i>
                    <div>Eshot</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsSectionActive("/eshot/hareketler") ? "active" : "")">
                        <a href="/eshot/hareketler" class="menu-link">
                            <div>Hareketler</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/eshot/kullanim-hakki") ? "active" : "")">
                        <a href="/eshot/kullanim-hakki" class="menu-link">
                            <div>Kullanım Hakkı</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsSectionActive("/eshot/ucret-bilgisi") ? "active" : "")">
                        <a href="/eshot/ucret-bilgisi" class="menu-link">
                            <div>Ücret Bilgisi</div>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- ================ HESAP YÖNETİMİ ================ -->
            <li class="menu-header small text-uppercase">
                <span class="menu-header-text">Hesap Yönetimi</span>
            </li>

            <li class="menu-item @(IsSectionActive("/account") ? "active open" : "")">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-cog"></i>
                    <div>Hesap Ayarları</div>
                </a>
                <ul class="menu-sub">
                    <li class="menu-item @(IsActive("/account/profile") ? "active" : "")">
                        <a href="/account/profile" class="menu-link">
                            <div>Profil</div>
                        </a>
                    </li>
                    <li class="menu-item @(IsActive("/account/change-password") ? "active" : "")">
                        <a href="/account/change-password" class="menu-link">
                            <div>Şifre Değiştir</div>
                        </a>
                    </li>
                </ul>
            </li>
        }

    </ul>
</aside>

@implements IDisposable

@code {
    /// <summary>
    /// Tam URL eşleşmesi kontrol eder
    /// </summary>
    private bool IsActive(string path)
    {
        var currentPath = new Uri(Navigation.Uri).AbsolutePath;
        return currentPath.Equals(path, StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Section (bölüm) bazlı eşleşme kontrol eder
    /// Örnek: "/personel/departman" -> "/personel" section'ında aktif
    /// </summary>
    private bool IsSectionActive(string sectionPath)
    {
        var currentPath = new Uri(Navigation.Uri).AbsolutePath;
        return currentPath.StartsWith(sectionPath, StringComparison.OrdinalIgnoreCase);
    }

    protected override void OnInitialized()
    {
        // ⭐ Kullanıcı TC'sini al ve sakla
        _tcKimlikNo = HttpContextAccessor.HttpContext?.User.FindFirst("TcKimlikNo")?.Value;
        if (!string.IsNullOrEmpty(_tcKimlikNo))
        {
            BankoModeState.SetCurrentUser(_tcKimlikNo);
            // ⭐ Kullanıcı bazlı event subscription (AsyncLocal'a bağımlı değil!)
            BankoModeState.SubscribeToUserChanges(_tcKimlikNo, OnBankoModeChanged);
        }

        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    private void OnBankoModeChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
        // ⭐ Kullanıcı bazlı event unsubscription
        if (!string.IsNullOrEmpty(_tcKimlikNo))
        {
            BankoModeState.UnsubscribeFromUserChanges(_tcKimlikNo, OnBankoModeChanged);
        }
    }
}